window.MobileSelect=function(){function e(e,t){return e.getElementsByClassName(t)}function t(e){this.mobileSelect,this.wheelsData=e.wheels,this.jsonType=!1,this.jsonData=[],this.checkDataType(),this.renderWheels(this.wheelsData),this.displayJson=[],this.cascade=!1,this.startY,this.moveEndY,this.moveY,this.oldMoveY,this.offset=0,this.offsetSum=0,this.oversizeBorder,this.curDistance=[],this.clickStatus=!1,this.init(e)}return t.prototype={constructor:t,init:function(t){var i=this;if(i.trigger=document.querySelector(t.trigger),i.wheel=e(i.mobileSelect,"wheel"),i.slider=e(i.mobileSelect,"selectContainer"),i.wheels=i.mobileSelect.querySelector(".wheels"),i.liHeight=i.mobileSelect.querySelector("li").offsetHeight,i.ensureBtn=i.mobileSelect.querySelector(".ensure"),i.closeBtn=i.mobileSelect.querySelector(".cancel"),i.grayLayer=i.mobileSelect.querySelector(".grayLayer"),i.popUp=i.mobileSelect.querySelector(".content"),i.callback=t.callback?t.callback:function(){},i.transitionEnd=t.transitionEnd?t.transitionEnd:function(){},i.initPosition=t.position?t.position:[],i.titleText=t.title?t.title:"",i.wheels.className+=" "+i.trigger.className,i.trigger.style.cursor="pointer",i.setTitle(i.titleText),i.checkCascade(),i.cascade&&i.initCascade(),0==i.initPosition.length)for(var s=0;s<i.slider.length;s++)i.initPosition.push(0);i.setCurDistance(i.initPosition),i.addListenerAll(),i.closeBtn.addEventListener("click",function(){i.mobileSelect.classList.remove("mobileSelect-show")}),i.ensureBtn.addEventListener("click",function(){i.mobileSelect.classList.remove("mobileSelect-show");for(var e="",t="",s=0;s<i.wheel.length;s++)e+=s==i.wheel.length-1?i.getValue(s):i.getValue(s)+" ",t+=s==i.wheel.length-1?i.getDataId(s):i.getDataId(s)+" ";i.trigger.innerHTML=e;var a=$(i.trigger).attr("data-id");if(i.trigger.setAttribute("data-id",t),$(i.trigger).hasClass("select-sc-address")){if(a!=t){$("span.select-qc-address").text("请选择").removeAttr("data-id"),$(".address-textarea").removeClass("aui-hide");var n=$(".wheels.select-qc-address"),r=JSON.parse(localStorage.take_meal_list)[t],l="";n.find("ul>li").remove();for(var s in r)l+='<li data-id="'+s+'">'+r[s]+"</li>";n.find("ul").append(l)}}else if($(i.trigger).hasClass("select-qc-address"))"-1"==t?$(".address-textarea").removeClass("aui-hide"):($(".address-textarea").addClass("aui-hide"),$(".f-textarea>textarea").val(""));else if($(i.trigger).hasClass("coupon-list")){for(var c="",s=0;s<i.wheel.length;s++)c+=s==i.wheel.length-1?i.getDataPrice(s):i.getDataPrice(s)+" ";var o=$(".pay-total").text(),d=$(".yh-money").text(),h=accAdd(o,d),u=accSub(h,c);$(".pay-total").text(u),$(".yh-money").text(c),i.trigger.setAttribute("data-price",c)}i.callback(i.getIndexArr(),i.getJson())}),i.trigger.addEventListener("click",function(){i.mobileSelect.classList.add("mobileSelect-show")}),i.grayLayer.addEventListener("click",function(){i.mobileSelect.classList.remove("mobileSelect-show")}),i.popUp.addEventListener("click",function(){event.stopPropagation()}),i.fixRowStyle()},setTitle:function(e){var t=this;t.titleText=e,t.mobileSelect.querySelector(".title").innerHTML=t.titleText},renderWheels:function(e){var t=this;t.mobileSelect=document.createElement("div"),t.mobileSelect.className="mobileSelect",t.mobileSelect.innerHTML='<div class="grayLayer"></div><div class="content"><div class="btnBar"><div class="fixWidth"><div class="cancel">取消</div><div class="title"></div><div class="ensure">选择</div></div></div><div class="panel"><div class="fixWidth"><div class="wheels"></div><div class="selectLine"></div><div class="shadowMask"></div></div></div></div>',document.body.appendChild(t.mobileSelect);var i="";for(var s in e){if(i+='<div class="wheel"><ul class="selectContainer">',t.jsonType)for(var a in e[s].data)i+=void 0!=e[s].data[a].d_price?"-1"==e[s].data[a].d_id?'<li data-id="'+e[s].data[a].d_id+'" data-price="'+e[s].data[a].d_price+'">'+e[s].data[a].d_name+"</li>":'<li data-id="'+e[s].data[a].d_id+'" data-price="'+e[s].data[a].d_price+'">'+e[s].data[a].d_name+"  ￥-"+e[s].data[a].d_price+"</li>":'<li data-id="'+e[s].data[a].d_id+'">'+e[s].data[a].d_name+"</li>";else for(var a in e[s].data)i+='<li data-id="'+a+'">'+e[s].data[a]+"</li>";i+="</ul></div>"}t.mobileSelect.querySelector(".wheels").innerHTML=i},addListenerAll:function(){for(var e=this,t=0;t<e.slider.length;t++)!function(t){e.addListenerWheel(e.wheel[t],t),e.addListenerLi(t)}(t)},addListenerWheel:function(e,t){var i=this;e.addEventListener("touchstart",function(){i.touch(event,this.firstChild,t)},!1),e.addEventListener("touchend",function(){i.touch(event,this.firstChild,t)},!1),e.addEventListener("touchmove",function(){i.touch(event,this.firstChild,t)},!1),e.addEventListener("mousedown",function(){i.dragClick(event,this.firstChild,t)},!1),e.addEventListener("mousemove",function(){i.dragClick(event,this.firstChild,t)},!1),e.addEventListener("mouseup",function(){i.dragClick(event,this.firstChild,t)},!0)},addListenerLi:function(e){for(var t=this,i=t.slider[e].getElementsByTagName("li"),s=0;s<i.length;s++)!function(s){i[s].addEventListener("click",function(){t.singleClick(this,s,e)},!1)}(s)},checkDataType:function(){var e=this;"object"==typeof e.wheelsData[0].data[0]&&(e.jsonType=!0,e.jsonData=e.wheelsData[0].data)},checkCascade:function(){var e=this;if(e.jsonType){for(var t=e.wheelsData[0].data,i=0;i<t.length;i++)if("childs"in t[i]&&t[i].childs.length>0){e.cascade=!0;break}}else e.cascade=!1},initCascade:function(){var e=this;e.displayJson.push(e.generateArrData(e.jsonData)),e.checkArrDeep(e.jsonData[0]),e.updateWheels()},generateArrData:function(e){for(var t=[],i=0;i<e.length;i++)t.push({id:e[i].id,value:e[i].value});return t},checkArrDeep:function(e){var t=this;"childs"in e&&e.childs.length>0&&(t.displayJson.push(t.generateArrData(e.childs)),t.checkArrDeep(e.childs[0]))},checkRange:function(e,t){for(var i=this,s=i.displayJson.length-1-e,a=0;a<s;a++)i.displayJson.pop();for(var n,a=0;a<=e;a++)n=0==a?i.jsonData[t[0]]:n.childs[t[a]];i.checkArrDeep(n),i.updateWheels(),i.fixRowStyle(),i.setCurDistance(i.resetPostion(e,t))},resetPostion:function(e,t){var i,s=this,a=t;if(s.slider.length>t.length){i=s.slider.length-t.length;for(var n=0;n<i;n++)a.push(0)}else if(s.slider.length<t.length){i=t.length-s.slider.length;for(var n=0;n<i;n++)a.pop()}for(var n=e+1;n<a.length;n++)a[n]=0;return a},updateWheels:function(){var e=this;if(e.wheel.length>e.displayJson.length)for(var t=e.wheel.length-e.displayJson.length,i=0;i<t;i++)e.wheels.removeChild(e.wheel[e.wheel.length-1]);for(var i=0;i<e.displayJson.length;i++)!function(t){var i="";if(e.wheel[t]){for(var s=0;s<e.displayJson[t].length;s++)i+='<li data-id="'+e.displayJson[t][s].id+'">'+e.displayJson[t][s].value+"</li>";e.slider[t].innerHTML=i}else{var a=document.createElement("div");a.className="wheel",i='<ul class="selectContainer">';for(var s=0;s<e.displayJson[t].length;s++)i+='<li data-id="'+e.displayJson[t][s].id+'">'+e.displayJson[t][s].value+"</li>";i+="</ul>",a.innerHTML=i,e.addListenerWheel(a,t),e.wheels.appendChild(a)}e.addListenerLi(t)}(i)},updateWheel:function(e,t){for(var i=this,s="",a=0;a<t.length;a++)s+="<li>"+t[a]+"</li>";i.slider[e].innerHTML=s,i.addListenerLi(e)},fixRowStyle:function(){for(var e=this,t=(100/e.wheel.length).toFixed(2),i=0;i<e.wheel.length;i++)e.wheel[i].style.width=t+"%"},getIndex:function(e){return Math.round((2*this.liHeight-e)/this.liHeight)},getIndexArr:function(){for(var e=this,t=[],i=0;i<e.curDistance.length;i++)t.push(e.getIndex(e.curDistance[i]));return t},getJson:function(){var e=this,t=[],i=e.getIndexArr();if(e.cascade)for(var s=0;s<e.wheel.length;s++)t.push(e.displayJson[s][i[s]]);else if(e.jsonType)for(var s=0;s<e.curDistance.length;s++)t.push(e.wheelsData[s].data[e.getIndex(e.curDistance[s])]);else for(var s=0;s<e.curDistance.length;s++)t.push(e.getValue(s));return t},calcDistance:function(e){return 2*this.liHeight-e*this.liHeight},setCurDistance:function(e){for(var t=this,i=[],s=0;s<t.slider.length;s++)i.push(t.calcDistance(e[s])),t.movePosition(t.slider[s],i[s]);t.curDistance=i},fixPosition:function(e){return-(this.getIndex(e)-2)*this.liHeight},movePosition:function(e,t){e.style.webkitTransform="translate3d(0,"+t+"px, 0)",e.style.transform="translate3d(0,"+t+"px, 0)"},locatePostion:function(e,t){this.curDistance[e]=this.calcDistance(t),this.movePosition(this.slider[e],this.curDistance[e])},updateCurDistance:function(e,t){this.curDistance[t]=parseInt(e.style.transform.split(",")[1])},getDistance:function(e){return parseInt(e.style.transform.split(",")[1])},getValue:function(e){var t=this,i=t.getIndex(t.curDistance[e]);return t.slider[e].getElementsByTagName("li")[i].innerHTML},getDataId:function(e){var t=this,i=t.getIndex(t.curDistance[e]);return t.slider[e].getElementsByTagName("li")[i].getAttribute("data-id")},getDataPrice:function(e){var t=this,i=t.getIndex(t.curDistance[e]);return t.slider[e].getElementsByTagName("li")[i].getAttribute("data-price")},touch:function(e,t,i){var s=this;switch(e=e||window.event,e.type){case"touchstart":s.startY=e.touches[0].clientY,s.oldMoveY=s.startY;break;case"touchend":if(s.moveEndY=e.changedTouches[0].clientY,s.offsetSum=s.moveEndY-s.startY,s.updateCurDistance(t,i),s.curDistance[i]=s.fixPosition(s.curDistance[i]),s.movePosition(t,s.curDistance[i]),s.oversizeBorder=-(t.getElementsByTagName("li").length-3)*s.liHeight,s.curDistance[i]+s.offsetSum>2*s.liHeight?(s.curDistance[i]=2*s.liHeight,setTimeout(function(){s.movePosition(t,s.curDistance[i])},100)):s.curDistance[i]+s.offsetSum<s.oversizeBorder&&(s.curDistance[i]=s.oversizeBorder,setTimeout(function(){s.movePosition(t,s.curDistance[i])},100)),s.transitionEnd(s.getIndexArr(),s.getJson()),s.cascade){var a=s.getIndexArr();a[i]=s.getIndex(s.curDistance[i]),s.checkRange(i,a)}break;case"touchmove":e.preventDefault(),s.moveY=e.touches[0].clientY,s.offset=s.moveY-s.oldMoveY,s.updateCurDistance(t,i),s.curDistance[i]=s.curDistance[i]+s.offset,s.movePosition(t,s.curDistance[i]),s.oldMoveY=s.moveY}},dragClick:function(e,t,i){var s=this;switch(e=e||window.event,e.type){case"mousedown":s.startY=e.clientY,s.oldMoveY=s.startY,s.clickStatus=!0;break;case"mouseup":if(s.moveEndY=e.clientY,s.offsetSum=s.moveEndY-s.startY,s.updateCurDistance(t,i),s.curDistance[i]=s.fixPosition(s.curDistance[i]),s.movePosition(t,s.curDistance[i]),s.oversizeBorder=-(t.getElementsByTagName("li").length-3)*s.liHeight,s.curDistance[i]+s.offsetSum>2*s.liHeight?(s.curDistance[i]=2*s.liHeight,setTimeout(function(){s.movePosition(t,s.curDistance[i])},100)):s.curDistance[i]+s.offsetSum<s.oversizeBorder&&(s.curDistance[i]=s.oversizeBorder,setTimeout(function(){s.movePosition(t,s.curDistance[i])},100)),s.clickStatus=!1,s.transitionEnd(s.getIndexArr(),s.getJson()),s.cascade){var a=s.getIndexArr();a[i]=s.getIndex(s.curDistance[i]),s.checkRange(i,a)}break;case"mousemove":e.preventDefault(),s.clickStatus&&(s.moveY=e.clientY,s.offset=s.moveY-s.oldMoveY,s.updateCurDistance(t,i),s.curDistance[i]=s.curDistance[i]+s.offset,s.movePosition(t,s.curDistance[i]),s.oldMoveY=s.moveY)}},singleClick:function(e,t,i){var s=this;if(s.cascade){var a=s.getIndexArr();a[i]=t,s.checkRange(i,a)}else s.curDistance[i]=(2-t)*s.liHeight,s.movePosition(e.parentNode,s.curDistance[i])}},t}();
//# sourceMappingURL=mobileSelect.js.map
