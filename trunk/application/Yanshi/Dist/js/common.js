function ajaxFun(e,t,a,r,i){$.ajax({type:"POST",url:apiUrl,data:JSON.stringify(e),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:beforeFune,success:a,complete:r,error:i})}function accAdd(e,t){var a,r,i,o,n;try{a=e.toString().split(".")[1].length}catch(d){a=0}try{r=t.toString().split(".")[1].length}catch(d){r=0}if(o=Math.abs(a-r),i=Math.pow(10,Math.max(a,r)),o>0){var s=Math.pow(10,o);a>r?(e=Number(e.toString().replace(".","")),t=Number(t.toString().replace(".",""))*s):(e=Number(e.toString().replace(".",""))*s,t=Number(t.toString().replace(".","")))}else e=Number(e.toString().replace(".","")),t=Number(t.toString().replace(".",""));return n=a>=r?a:r,((e+t)/i).toFixed(n)}function accSub(e,t){var a,r,i,o;try{a=e.toString().split(".")[1].length}catch(n){a=0}try{r=t.toString().split(".")[1].length}catch(n){r=0}return i=Math.pow(10,Math.max(a,r)),o=a>=r?a:r,((e*i-t*i)/i).toFixed(o)}function createLoadDom(e){var t=$("<div />").addClass("load-wrapper loading-"+e),a=$("<img />").attr("src",localStorage.localStorage_url+"loading.gif"),r=$("<span />").text("加载中");return t.append(a,r),t}function createDialog(){var e=$("<div />").addClass("zhezhao"),t=$("<img />").attr("src",localStorage.localStorage_url+"loading.gif");return e.append(t),e}function checkMobileNo(e){var t=/^1[3|7|5|8]\d{9}$/;return!!t.test(e)}function clearEvt(e,t){e.bind("click",function(){t.val()&&t.val("")})}function checkIsNumber(e){var t=new RegExp("^[0-9]*[1-9][0-9]*$"),a=new RegExp("^(([0-9]+\\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\\.[0-9]+)|([0-9]*[1-9][0-9]*))$");return!(!t.test(e)&&!a.test(e))}function getCurTime(){var e=new Date,t=e.getFullYear().toString().substr(2),a=e.getMonth()+1<10?"0"+(e.getMonth()+1):(e.getMonth()+1).toString(),r=e.getDate()<10?"0"+e.getDate():e.getDate().toString(),i=e.getHours()%12<10?"0"+e.getHours()%12:(e.getHours()%12).toString(),o=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes().toString(),n=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds().toString();return t+a+r+i+o+n}function getCurDate(){var e=new Date,t=e.getFullYear().toString().substr(2),a=e.getMonth()+1<10?"0"+(e.getMonth()+1):(e.getMonth()+1).toString(),r=e.getDate()<10?"0"+e.getDate():e.getDate().toString();return t+a+r}function getParams(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(t);return null!=a?unescape(a[2]):null}function getRandStr(e){for(var t="",a=0;a<e;a++)t+=Math.floor(10*Math.random()).toString();return t}function gotoLocation(e,t){window.location.href=e+t}function mergeInfo(e,t){var a=wechat,r=getRandStr(5),i=getCurTime(),o=hex_sha1(hex_sha1(i+r)+a),n={header:{timestamp:i,nonce:r,signature:o},cmd:{name:e},data:t};return n}var apiUrl="../../../api.php",wechat=100,Index=function(e){var t=e('input[type="hidden"].detail-url').val(),a={type:{1:"健身餐",2:"健康餐",3:"沙拉",4:"饮品",5:"零食"},init:function(){var t=e('input[name="member_id"]').val();t&&window.localStorage.setItem("member_id",t),window.localStorage.setItem("localStorage_url",e(".localStorage-url").val());for(var r in a.type)a.getGoodsInfo(r);a.pullRefresh()},pullRefresh:function(){var t=new auiPullToRefresh({container:document.querySelector(".aui-refresh-content"),triggerDistance:100},function(r){"success"==r.status&&setTimeout(function(){for(var r in a.type){var i=e(".ys-home-index .ys-goods-list>.aui-content").eq(r-1).children(".aui-card-list");i.children(".ys-list-content").children().remove(),i.find(".ys-list-content-padded>.aui-row").children().remove(),a.getGoodsInfo(r)}t.cancelLoading()},1500)})},setCopyInfo:function(e,t){if(e.find(".ys-copy-img").attr({src:t.goods_img,"data-id":t.spu_id}),e.find(".ys-copy-title").attr("data-id",t.spu_id).text(t.goods_name),e.find(".ys-copy-price").text(parseInt(t.goods_price)),t.count>0?e.find(".ys-copy-count").text(t.count):e.find(".ys-copy-count").text("0"),""==t.recommend_price_area||0==t.recommend_price_area||void 0==t.recommend_price_area)e.find(".ys-list-item-right").remove();else{var r=a.changePriceArea(t.recommend_price_area);e.find(".ys-copy-price-area").text(r)}return e},changePriceArea:function(e){var t=e.split("-"),a=[];for(var r in t)a.push(parseInt(t[r]));return a.join("-")},jumpEvt:function(a){a.find(".ys-copy-img, .ys-copy-title").click(function(){var a=e(this).attr("data-id");gotoLocation(t,"&id="+a)})},getGoodsInfo:function(t){var r={class_type:t},i=mergeInfo("goods_class_info",r),o=e(".ys-home-index .ys-goods-list>.aui-content").eq(t-1).children(".aui-card-list");e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(i),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){var e=createLoadDom(t);o.children(".ys-list-content").append(e)},success:function(r){e(".loading-"+t).remove();var i=r.errcode;if(1==i){var n=r.data.list;if(n.length){for(var d in n){var s,c;2==n[d].recommend?(s=e(".copy-recommend").clone(!0),c=o.children(".ys-list-content")):1==n[d].recommend&&(s=e(".copy-item").clone(!0),c=o.find(".ys-list-content-padded>.aui-row"));var l=a.setCopyInfo(s,n[d]);c.append(l.html())}a.jumpEvt(o)}else{var u=e('<img src="'+localStorage.localStorage_url+'img_empty.png" />').addClass("empty-img"),p=e("<div />").addClass("empty-text").text("暂无商品");o.children(".ys-list-content").append(u,p)}}else alert(r.errmsg)},complete:function(){},error:function(a){e(".loading-"+t).remove(),alert("获取商品列表失败，请刷新重试")}})}};return{init:a.init}}(jQuery),GoodsDetail=function(e){var t,a=new auiDialog,r=[],i=e('input[name="addToCartUrl"]').val(),o=e('input[name="reserveUrl"]').val(),n={init:function(){n.getGoodsDetail(),n.goToCar(),n.addToCart(),n.openSpellDialog(),n.reserveEvt()},goToCar:function(){e(".goto-car").click(function(){gotoLocation(i,"")})},addToCart:function(){e(".addToCart").bind("click",function(){var t=getParams("id"),a=n.getSkuId("|");if(!a)return alert("你还未给商品选择规格哟"),!1;var r={spu_id:t,member_id:localStorage.member_id,sku_spec:a},o=mergeInfo("add_cart",r);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(o),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){var t=createDialog();e(".ys-product-detail").append(t)},success:function(t){e(".zhezhao").remove(),1==t.errcode?gotoLocation(i,""):alert(t.errmsg)},error:function(t){e(".zhezhao").remove(),alert("网络错误，请刷新重试")}})})},getSkuId:function(t){var a="";return e(".portion-type>div").hasClass("ys-type-selected")&&e(".cycle-type>div").hasClass("ys-type-selected")&&(a+=e(".portion-type .ys-type-selected .ys-type-select").text(),a+=t,a+=e(".cycle-type .ys-type-selected .ys-type-select").text()),a},specSelectEvt:function(t){t.click(function(){if(!e(this).parent().hasClass("ys-type-selected")){t.parent().removeClass("ys-type-selected"),e(this).parent().addClass("ys-type-selected");var a=n.getSkuId("|");a&&(e(".ys-goods-price").text(r[a].goods_price),e(".ys-goods-price").next("em").remove())}})},closeSpellDialog:function(){e(".dialog-exit").click(function(){e(".aui-mask").removeClass("aui-mask-in"),e(".aui-dialog").remove()})},checkPtInfo:function(){var a,r=e(".aui-dialog-body .dialog-tab>.aui-active").attr("data-num");2==r?(a=0,t=2):4==r&&(a=1,t=3);var i={};e(".aui-dialog-body .aui-tab-content>.aui-list").eq(a).find("li.aui-list-item").each(function(){return""!=e(this).find("input").val()&&checkMobileNo(e(this).find("input").val())?void(i[e(this).index()]=e(this).find("input").val()):(alert("输入的好友手机号不正确"),!1)}),n.getSkuIds(i)},openSpellDialog:function(){e(".spellDialogBtn").click(function(){var t=n.getSkuId("，");if(t){var i=n.getSkuId("|"),o=e("#dialog-inner-content .dialog-tab>.aui-active").attr("data-num");2==o?e(".dialog-min-price").text(r[i].sku_2_price):4==o&&e(".dialog-min-price").text(r[i].sku_4_price),e(".dialog-sku-spec").text(t),a.alert({title:"",msg:document.getElementById("dialog-inner-content").innerHTML,buttons:["预订"]},function(e){1==e.buttonIndex&&n.checkPtInfo()}),n.closeSpellDialog(),n.tabSelectEvt(i)}else alert("您还未选择商品规格哟")})},getGoodsDetail:function(){var t=getParams("id"),a={spu_id:t},i=mergeInfo("get_goods_info",a);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(i),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){var t=createDialog();e(".ys-product-detail").append(t)},success:function(t){if(e(".zhezhao").remove(),1==t.errcode){var a=t.data;e(".ys-goods-name").text(a.goods_name),e(".ys-goods-price").text(a.goods_price),e(".notice-desc").text(a.delivery_explain),""==a.count?e(".ys-goods-count").text(0):e(".ys-goods-count").text(a.count),e(".ys-goods-price-area").text(a.recommend_price_area),r=a.sku;var i=a.goods_slide,o="";for(var d in i)o+='<div class="aui-slide-node bg-dark"><img src="'+i[d]+'" /></div>';e("#aui-slide>.aui-slide-wrap").append(o);var s=(new auiSlide({container:document.getElementById("aui-slide"),height:260,speed:300,autoPlay:2e3,pageShow:!0,pageStyle:"dot",loop:!0,dotPosition:"center",currentPage:function(){}}),a.goods_img),c="";for(var l in s)c+='<div class="aui-card-list-content"><img src="'+s[l]+'" /></div>';e(".ys-goods-imgs").append(c);var u=a.spec.portion,p=a.spec.cycle,f="",m="";for(var g in u)f+='<div class="ys-col-xs-7"><span class="ys-type-select">'+u[g]+"</span></div>";e(".portion-type").append(f);for(var v in p)m+='<div class="ys-col-xs-7"><span class="ys-type-select">'+p[v]+"</span></div>";e(".cycle-type").append(m),e(".dialog-goods-img").attr("src",i[0]),n.specSelectEvt(e(".portion-type .ys-type-select")),n.specSelectEvt(e(".cycle-type .ys-type-select"))}else alert(t.errmsg)},error:function(e){alert("获取商品信息失败，请刷新重试")}})},getSkuIds:function(a){var r=n.getSkuId("|");if(!r)return alert("您还未选择商品规格哟"),!1;var i={spec:r,spu_id:getParams("id")},o=mergeInfo("get_goods_sku_by_spec",i);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(o),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){},success:function(e){if(1==e.errcode){var r,i,o={};if(o.member_id=localStorage.member_id,""==a){var d={};d[0]=e.data.sku_id,o.sku_ids=d,r="create_goods_order",i=2}else o.sku_id=e.data.sku_id,o.member_mobiles=a,o.order_type=t,r="create_pin_goods_order",i=1;n.createGoodsOrder(r,o,i)}else alert(e.errmsg)},error:function(e){}})},createGoodsOrder:function(t,a,r){var i=mergeInfo(t,a);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(i),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){var t=createDialog();e(".ys-product-detail").append(t)},success:function(t){e(".zhezhao").remove(),1==t.errcode?(window.localStorage.setItem("orderData",JSON.stringify(t.data)),gotoLocation(o,"&payState="+r)):alert(t.errmsg)},error:function(t){e(".zhezhao").remove(),alert("网络错误，请刷新重试")}})},reserveEvt:function(){e(".reserve-btn").bind("click",function(){e(this);n.getSkuIds("")})},tabSelectEvt:function(t){e(".dialog-tab>.aui-tab-item").click(function(){if(!e(this).hasClass("aui-active")){var a=e(this).index(),i=e(this).attr("data-num");2==i?e(".dialog-min-price").text(r[t].sku_2_price):4==i&&e(".dialog-min-price").text(r[t].sku_4_price),e(".dialog-tab>.aui-tab-item").removeClass("aui-active"),e("#dialog-inner-content .dialog-tab>.aui-tab-item").eq(a).addClass("aui-active"),e(".aui-dialog-body .dialog-tab>.aui-tab-item").eq(a).addClass("aui-active"),e(".aui-tab-content>.aui-list").addClass("aui-hide"),e("#dialog-inner-content .aui-tab-content>.aui-list").eq(a).removeClass("aui-hide"),e(".aui-dialog-body .aui-tab-content>.aui-list").eq(a).removeClass("aui-hide")}})}};return{init:n.init}}(jQuery),Reserve=function(e){var t={},a=[],r={2:"已付款",6:"未付款"},i={init:function(){i.createGoodsOrder(),i.changeAddress(),i.setAddressInfo(),i.wxPay()},setAddressInfo:function(e){void 0==getParams("address_id")?i.getDefaultAddress():i.getAddressInfo()},getAddressInfo:function(){var a={member_id:localStorage.member_id,address_id:getParams("address_id")},r=mergeInfo("get_address",a);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(r),dataType:"json",contentType:"application/json; charset=utf-8",success:function(a){if(1==a.errcode){var r=a.data;t=r,t.address=r.content,e(".address-info .order-address").text(r.content),e(".address-info .order-username").text(r.r_name),e(".address-info .order-tel").text(r.r_mobile)}},error:function(e){alert("网络错误，请刷新重试")}})},getTimeArea:function(t){var a={},r=mergeInfo("get_time_area",a);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(r),dataType:"json",contentType:"application/json; charset=utf-8",success:function(a){if(1==a.errcode){var r=a.data.time_area,i=r.noon,o=r.night;if(1==t||2==t)for(var n in i){var d=e("<option />").val(n).text(i[n]);e('select[name="select-day-area"]').append(d).removeClass("aui-hide")}if(1==t||3==t)for(var n in o){var d=e("<option />").val(n).text(o[n]);e('select[name="select-night-area"]').append(d).removeClass("aui-hide")}}},error:function(e){alert("网络错误，请刷新重试")}})},changeRadioEvt:function(t){t.click(function(){var t=e(this).val();void 0!=e(this).attr("checked")?1==t?e(".delivery-day-area").removeClass("aui-hide"):e(".delivery-night-area").removeClass("aui-hide"):1==t?e(".delivery-day-area").addClass("aui-hide"):e(".delivery-night-area").addClass("aui-hide")})},addToList:function(){e(".recommend_list .aui-list-item .yp-select-btn").click(function(){var t=e(this),r=t.attr("data-state"),i=t.attr("data-spu"),o=t.attr("data-sku"),n=t.attr("data-price"),d=e(".pay-total").text();if(1==r){var s=e(".recommend_list li.aui-list-item[data-spu="+i+"]").clone(!0);s.find(".yp-detele-wrapper").remove(),e(".ys-goods-info .aui-list").append(s),t.text("取消").attr("data-state",2),a.push(o),d=accAdd(d,n)}else 2==r&&(e(".ys-goods-info li.aui-list-item[data-spu="+i+"]").remove(),a.splice(e.inArray(o,a),1),t.text("加入订单").attr("data-state",1),d=accSub(d,n));e(".pay-total").text(d)})},changeAddress:function(){e(".address-info").click(function(){localStorage.setItem("urlState","reserve"),gotoLocation(e(this).attr("data-url"),"")})},createGoodsOrder:function(){var t=JSON.parse(localStorage.orderData),o=0;delivery_time=t.delivery_time,info=t.goods_info,order_sn=t.order_sn,recommend_goods=t.recommend_goods,pin_info=t.pin_info,voucher_info=t.voucher_info,e(".order_sn").text(order_sn);for(var n in info){var d=e(".copy-item").clone(!0);d.find(".goods_img").attr("src",info[n].goods_img),d.find(".goods_name").text(info[n].goods_name),d.find(".goods_price").text(info[n].goods_price),d.find(".goods_spec").text(info[n].goods_spec.split("|").join(",")),d.find(".delivery_num").text("送餐次数："+info[n].delivery_num+"次"),a.push(info[n].sku_id),e(".ys-goods-info>.aui-list").append(d.html()),o=accAdd(o,info[n].goods_price)}if(void 0==recommend_goods||0==recommend_goods.length||getParams("order_type"))e(".recommend_list").remove();else{for(var s in recommend_goods){var c=e(".copy-item").clone(!0);c.children(".aui-list-item").attr({"data-spu":recommend_goods[s].spu_id,"data-sku":recommend_goods[s].sku_id}),c.find(".goods_img").attr("src",recommend_goods[s].goods_img),c.find(".goods_name").text(recommend_goods[s].goods_name),c.find(".goods_price").text(recommend_goods[s].goods_price),c.find(".goods_spec").text(recommend_goods[s].goods_spec.split("|").join(",")),c.find(".delivery_num").text("送餐次数："+recommend_goods[s].delivery_num+"次");var l=e('<div class="yp-detele-wrapper"/>'),u=e('<div class="yp-select-btn" />').text("加入订单").attr({"data-spu":recommend_goods[s].spu_id,"data-sku":recommend_goods[s].sku_id,"data-state":1,"data-price":recommend_goods[s].goods_price});l.append(u),c.find(".aui-list-item-inner").after(l),e(".recommend_list .aui-list").append(c.html())}i.addToList()}if(void 0==pin_info||0==pin_info.length)e(".pt-content").remove();else{var p=0;for(var f in pin_info){var m=e(".copy-pt-item").clone(!0);m.find(".pt-name").text(pin_info[f].nick_name),m.find(".pt-mob").text(pin_info[f].mobile),m.find(".pt-price").text(pin_info[f].pin_price),m.find(".pt-state").text(r[pin_info[f].pin_state]),p=accAdd(p,pin_info[f].pin_price),e(".pt-list").append(m.html())}e(".yh-money").text(p),o=accSub(o,p)}if(void 0==voucher_info||0==voucher_info.length)e(".coupon-area").remove();else{e(".coupon-list").text(voucher_info.length+"个可用");var g=[],v={};v.d_id=-1,v.d_name="不使用优惠券",v.d_price=0,g.push(v);for(var _ in voucher_info){var y={};y.d_id=voucher_info[_].v_b_id,y.d_name=voucher_info[_].voucher_name,y.d_price=voucher_info[_].voucher_price,g.push(y)}new MobileSelect({trigger:".coupon-list",title:"",wheels:[{data:g}]})}var h=1;if(1==delivery_time.length){var b=delivery_time[0];1==b?(h=2,e("li.delivery-night-item").remove()):2==b&&(h=3,e("li.delivery-day-item").remove())}i.changeRadioEvt(e('input[name="delivery-time"]')),i.getTimeArea(h),e(".pay-total").text(o)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},getDefaultAddress:function(){var a={member_id:localStorage.member_id},r=mergeInfo("get_default_address",a);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(r),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){},success:function(a){if(1==a.errcode){var r=a.data,o=i.isEmptyObject(r);o?e(".address-info").html("暂无默认收货地址").css("font-size","15px"):(t=r,e(".address-info .order-address").text(r.address),e(".address-info .order-username").text(r.r_name),e(".address-info .order-tel").text(r.r_mobile))}else alert(a.errmsg)},error:function(e){alert("网络错误，请刷新重试")}})},wxPay:function(){e(".wx-pay").click(function(){var r={},o=1,n="";if(1==getParams("payState")){if(r.order_info={order_sn:e(".order_sn").text()},i.isEmptyObject(t))return alert("亲，你还没设置默认收货地址呢，快先去设置一下吧"),!1;if(r.address_info=t,!e("#reserveDayDate").val())return alert("亲，你还没选择送餐日期呢"),!1;if(r.order_info.delivery_date=e("#reserveDayDate").val(),!e('input[name="delivery-time"]:checked').val())return alert("亲，你还未选择送餐时间段呢"),!1;var d=[];e('input[name="delivery-time"]:checked').each(function(){d.push(e(this).val())}),r.order_info.delivery_time=d,e(".f-textarea>textarea").val()&&(r.order_info.order_content=e(".f-textarea>textarea").val()),n="create_pin_payment"}else if(2==getParams("payState")){if(r.member_id=localStorage.member_id,!(e(".pay-total").text()>0))return alert("亲，付款金额必须大于等于0呢"),!1;if(r.order_info={order_sn:e(".order_sn").text(),order_type:o,amount:e(".pay-total").text()},i.isEmptyObject(t))return alert("亲，你还没设置默认收货地址呢，快先去设置一下吧"),!1;if(r.address_info=t,!e("#reserveDayDate").val())return alert("亲，你还没选择送餐日期呢"),!1;if(r.order_info.delivery_date=e("#reserveDayDate").val(),r.goods_info={},!e('input[name="delivery-time"]:checked').val())return alert("亲，你还未选择送餐时间段呢"),!1;var d=[],s={},c=!0;if(e('input[name="delivery-time"]:checked').each(function(){if(d.push(e(this).val()),1==e(this).val()){var t=e('select[name="select-day-area"]').find("option:selected").val(),a=e('select[name="select-day-area"]').find("option:selected").text();t==-1?(alert("亲，还没选择午餐送餐时间段呢"),c=!1):s[0]=a}else if(2==e(this).val()){var r=e('select[name="select-night-area"]').find("option:selected").val(),i=e('select[name="select-night-area"]').find("option:selected").text();r==-1?(alert("亲，还没选择晚餐送餐时间段呢"),c=!1):s[1]=i}}),!c)return!1;r.goods_info.time_area=s,r.goods_info.delivery_time=d,e(".f-textarea>textarea").val()&&(r.order_info.order_content=e(".f-textarea>textarea").val()),(void 0!=e(".coupon-list").val()&&void 0!=e(".coupon-list").attr("data-id")||"-1"!=e(".coupon-list").attr("data-id"))&&(r.voucher_info={v_id:e(".coupon-list").attr("data-id"),v_price:e(".coupon-list").attr("data-price")}),r.goods_info.sku_ids=a,n="create_payment"}var l=mergeInfo(n,r);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(l),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){var t=createDialog();e(".ys-reserve").append(t)},success:function(t){e(".zhezhao").remove(),1==t.errcode?gotoLocation(e('input[name="wx-url"]').val(),"&openid="+t.data.openid+"&order_amount="+t.data.order_amount+"&order_sn="+t.data.order_sn):alert(t.errmsg)},error:function(t){e(".zhezhao").remove(),alert("网络错误，请刷新重试")}})})}};return{init:i.init}}(jQuery),Order=function(e){var t=!1,a=1,r=10,i=e("#tab>.aui-tab-item.aui-active").attr("data-index"),o={init:function(){o.tabSelectEvt(),o.getOrderList(i),o.pullRefresh(),o.scrollEvt()},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},gotoGoodsDetail:function(){e(".order-list-content>.aui-content").click(function(){var t=e(this).find(".order_sn").attr("data-id");gotoLocation(e('input[name="detail_url"]').val(),"&id="+t)})},getOrderList:function(i){var n={member_id:localStorage.member_id,state:i,page:a,page_size:r},d=mergeInfo("get_order_list",n);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(d),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){var t=createLoadDom("order");e(".ys-order-list .order-list-content").append(t)},success:function(a){if(e(".loading-order").remove(),1==a.errcode){var r=a.data.order_info;if(void 0==r||o.isEmptyObject(r)){var n=e("<div />").addClass("empty-text").text("无更多数据").css({"margin-top":"15px","margin-bottom":"30px","font-size":"12px"});e(".ys-order-list .order-list-content").append(n)}else{t=!0;for(var d in r){var s=e(".copy-content").clone(!0),c=r[d].delivery_num,l=r[d].delivery_time,u="",p=r[d].order_goods;if(2==l.length)u="含中、晚餐";else{var f=l[0];u=1==f?"含中餐":"含晚餐"}if(3==i||4==i)var m=r[d].delivery_surplus_num;s.find(".order_sn").text(r[d].order_sn).attr("data-id",r[d].order_id);for(var g in p)_p=e(".copy-item").clone(!0),_p.find(".goods-img").attr("src",p[g].goods_img),_p.find(".goods-name").text(p[g].goods_name),_p.find(".goods-price").text(p[g].goods_price),_p.find(".goods_spec").text(p[g].goods_spec.split("|").join(",")),_p.find(".order-num").text("总送餐次数："+c+"次"),_p.find(".order-time").text(u),3==i||4==i?_p.find(".delivery_surplus").text("剩余次数："+m+"次"):_p.find(".delivery_surplus").remove(),s.find(".aui-list").append(_p.html());e(".ys-order-list .order-list-content").append(s.html())}o.gotoGoodsDetail()}}else alert(a.errmsg)},error:function(t){e(".loading-order").remove()}})},pullRefresh:function(){var t=new auiPullToRefresh({container:document.querySelector(".aui-refresh-content"),triggerDistance:100},function(r){"success"==r.status&&setTimeout(function(){a=1,e(".ys-order-list .order-list-content").children().remove(),o.getOrderList(e("#tab>.aui-active").attr("data-index")),t.cancelLoading()},1500)})},tabSelectEvt:function(){e("#tab>.aui-tab-item").click(function(){if(!e(this).hasClass("aui-active")){var t=e(this).index();gotoLocation(orderUrl[t],"")}})},scrollEvt:function(){new auiScroll({listen:!0,distance:0},function(r){r.isToBottom&&t&&(t=!1,a++,o.getOrderList(e("#tab>.aui-active").attr("data-index")))})}};return{init:o.init}}(jQuery),OrderDetail=function(e){var t={1:"待付款",2:"已付款",3:"配送中",4:"已送达",5:"交易完成",6:"拼团未付款",7:"拼团个人已付款",8:"拼团付款完成"},a={},r=[],i="",o={2:"已付款",6:"未付款"},n={init:function(){n.getOrderDetail(),n.changeAddress()},changeAddress:function(){e(".order-edit-address").click(function(){localStorage.setItem("urlState","orderDetail"),gotoLocation(e(this).attr("data-url"),"&id="+getParams("id"))})},setAddressInfo:function(t){if(void 0==getParams("address_id")){var r=t.address_info,i=t.r_name,o=t.r_mobile;null==r&&null==i&&null==o?(r="",i="",o=""):a=t,e(".order-address").text(r),e(".order-username").text(i),e(".order-tel").text(o)}else n.getAddressInfo()},changeOrderAddress:function(t){t.order_id=getParams("id");var a=mergeInfo("change_order_address",t);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(a),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){},error:function(e){alert("网络错误，请刷新重试")}})},applyDelayed:function(t){var a={member_id:localStorage.member_id,order_id:getParams("id"),delay_time:t},r=mergeInfo("apply_delayed",a);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(r),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){1==e.errcode},error:function(e){alert("网络错误，请刷新重试")}})},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},getAddressInfo:function(){var t={member_id:localStorage.member_id,address_id:getParams("address_id")},r=mergeInfo("get_address",t);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(r),dataType:"json",contentType:"application/json; charset=utf-8",success:function(t){if(1==t.errcode){var r=t.data;r.address=r.content,e(".order-address").text(r.content),e(".order-username").text(r.r_name),e(".order-tel").text(r.r_mobile),a=r,n.changeOrderAddress(r)}},error:function(e){alert("网络错误，请刷新重试")}})},continuePay:function(t){e(".order-sub-btn").click(function(){if(1==t.state)gotoLocation(e('input[name="wx-url"]').val(),"&openid="+t.openid+"&order_amount="+t.order_amount+"&order_sn="+t.order_sn);else if(6==t.state){var o={order_info:{order_sn:i,delivery_time:r}};if(""==e("#ps-time").val())return alert("配送时间不能为空哦"),!1;if(o.order_info.delivery_date=e("#ps-time").val(),n.isEmptyObject(a))return alert("亲，还未设置送货地址呢"),!1;o.address_info=a;var d=mergeInfo("create_pin_payment",o);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(d),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){var t=createDialog();e(".ys-order-detail").append(t)},success:function(t){e(".zhezhao").remove(),1==t.errcode?gotoLocation(e('input[name="wx-url"]').val(),"&openid="+t.data.openid+"&order_amount="+t.data.order_amount+"&order_sn="+t.data.order_sn):alert(t.errmsg)},error:function(t){e(".zhezhao").remove(),alert("网络错误，请刷新重试")}})}})},getOrderDetail:function(){var a=getParams("id"),d={order_id:a},s=mergeInfo("get_order_info",d);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(s),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){var t=createDialog();e(".ys-order-detail").append(t)},success:function(a){if(e(".zhezhao").remove(),1==a.errcode){var d=a.data.address,s=a.data.order_info,c=a.data.order_goods;pin_info=a.data.pin_info,void 0!=s.content&&s.content?e(".order-remark").text(s.content):e(".order-remark").text("暂无信息"),e(".order_amount").text(s.order_amount),e(".order_state").text(t[s.state]),e(".order-time").text(s.create_time),e(".order_sn").text(s.order_sn),n.setAddressInfo(d);var l=s.delivery_num,u=s.delivery_surplus_num,p=s.delivery_time,f="",m=s.delivery_date,g=s.time_area;if(1!=s.state&&6!=s.state||(n.continuePay(s),e(".order-sub-wrap").removeClass("aui-hide")),2==p.length)f="含中、晚餐";else{var v=p[0];f=1==v?"含中餐":"含晚餐"}r=p,i=s.order_sn,void 0!=g&&null!=g&&0!=g?2==g.length?(e(".time-area-day").text(g[0]),e(".time-area-night").text(g[1])):1==g.length&&(void 0!=g[0]&&(e(".time-area-night-info").addClass("aui-hide"),e(".time-area-day").text(g[0])),void 0!=g[1]&&(e(".time-area-day-info").addClass("aui-hide"),e(".time-area-night").text(g[1]))):e(".time-area-night-info, .time-area-day-info").addClass("aui-hide"),void 0==m&&null==m||e("#ps-time").val(m);for(var _ in c)_p=e(".copy-item").clone(!0),_p.find(".goods-img").attr("src",c[_].goods_img),_p.find(".goods-name").text(c[_].goods_name),_p.find(".goods-price").text(c[_].goods_price),_p.find(".goods_spec").text(c[_].goods_spec.split("|").join(",")),_p.find(".order-num").text("总送餐次数："+l+"次"),_p.find(".order-time").text(f),void 0==u?_p.find(".delivery_surplus").remove():""==u||0==u?_p.find(".delivery_surplus").text("剩余次数：0次"):_p.find(".delivery_surplus").text("剩余次数："+u+"次"),e(".ys-order-list .aui-list").append(_p.html());if(void 0==pin_info||0==pin_info.length)e(".pt-content").remove();else{var y=0;for(var h in pin_info){var b=e(".copy-pt-item").clone(!0);b.find(".pt-name").text(pin_info[h].nick_name),b.find(".pt-mob").text(pin_info[h].member_mobile),b.find(".pt-price").text(pin_info[h].pin_price),b.find(".pt-state").text(o[pin_info[h].pin_state]),y=accAdd(y,pin_info[h].pin_price),e(".pt-list").append(b.html())}e(".pt-price").text(y),e(".pt-content").show()}}else alert(a.errmsg)},error:function(t){e(".zhezhao").remove(),alert("网络错误，请刷新重试")}})}};return{delay:n.applyDelayed,init:n.init}}(jQuery),Account=function(e){var t={init:function(){t.getUserInfo()},getUserInfo:function(){var t={member_id:localStorage.member_id},a=mergeInfo("get_member",t);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(a),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){var t=createDialog();e(".ys-myaccount").append(t)},success:function(t){e(".zhezhao").remove();var a=localStorage.localStorage_url;if(1==t.errcode){var r=e(".user-logo"),i=e(".user-no"),o=e(".user-sex>img");t.data.nick_name?i.text(t.data.nick_name):i.text(""),1==t.data.sex?o.attr("src",a+"ico_mr.png"):o.attr("src",a+"ico_lady.png"),t.data.avatar?r.attr("src",t.data.avatar):r.attr("src",a+"my-logo.jpg"),window.localStorage.setItem("sex",t.data.sex),window.localStorage.setItem("username",t.data.nick_name)}else alert(t.errmsg)},error:function(t){e(".zhezhao").remove(),alert("用户信息获取失败，请刷新重试")}})}};return{init:t.init}}(jQuery),Address=function(e){var t={init:function(){t.getAddressList(),t.addAddressEvt()},clickItemEvt:function(){e(".aui-list .aui-list-item").click(function(t){if(t.stopPropagation(),"orderDetail"==localStorage.urlState){var a=e('input[name="order-url"]').val();gotoLocation(a,"&address_id="+e(this).attr("id")+"&id="+getParams("id"))}else if("reserve"==localStorage.urlState){var a=e('input[name="order-url1"]').val();gotoLocation(a,"&address_id="+e(this).attr("id"))}})},addAddressEvt:function(){e(".add-address-btn").click(function(t){t.stopPropagation();var a=e('input[name="add-url"]').val(),r=e('input[name="address-state"]').val(),i="&state="+r;2==r&&(i+="&orderId="+getParams("id")),gotoLocation(a,i)})},changeDefaultAddress:function(){e(".ys-address-list .aui-radio").click(function(t){t.stopPropagation();var a=e(this),r=a.parent(".radio-label").attr("address-id"),i={member_id:localStorage.member_id,address_id:r},o=mergeInfo("change_address_default",i);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(o),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){var t=createDialog();e(".ys-address-list").append(t)},success:function(t){e(".zhezhao").remove(),1==t.errcode?(e(".ys-address-list .aui-radio").next("span").text("设为默认"),a.next("span").text("默认地址"),e(".ys-address-list .aui-radio").parent(".radio-label").removeClass("default-label"),a.parent(".radio-label").addClass("default-label")):alert(t.errmsg)},error:function(t){e(".zhezhao").remove(),alert("默认地址设置失败，请刷新重试")}})})},editEvt:function(){e(".edit-img").click(function(t){t.stopPropagation();var a=e('input[name="edit-url"]').val(),r=e(this).attr("data-id"),i=e('input[name="address-state"]').val(),o="&id="+r+"&state="+e('input[name="address-state"]').val();2==i&&(o+="&orderId="+getParams("id")),gotoLocation(a,o)})},delEvt:function(){e(".del-img").click(function(t){t.stopPropagation();var a=e(this),r=new auiDialog;r.alert({title:"温馨提示",msg:"是否删除地址",buttons:["取消","确定"]},function(t){if(2==t.buttonIndex){var r={member_id:localStorage.member_id,address_id:a.attr("data-id")},i=mergeInfo("del_address",r);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(i),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){var t=createDialog();e(".ys-address-list").append(t)},success:function(t){if(e(".zhezhao").remove(),1==t.errcode){var r=a.attr("data-id");e('li.aui-list-item[id="'+r+'"]').remove()}else alert(t.errmsg)},error:function(t){e(".zhezhao").remove(),alert("网络错误， 请刷新重试")}})}})})},getAddressList:function(){var a={member_id:localStorage.member_id},r=mergeInfo("get_address_list",a);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(r),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){var t=createLoadDom("address");e(".ys-address-list .aui-list").append(t)},success:function(a){e(".loading-address").remove();var r=a.errcode;if(1==r){var i=a.data.list;if(i){for(var o in i){var n=e(".address-item-copy").clone(!0);n.children(".aui-list-item").attr("id",i[o].address_id),n.find(".order-address").text(i[o].address),n.find(".order-username").text(i[o].r_name),n.find(".order-tel").text(i[o].r_mobile),n.find(".radio-label").attr("address-id",i[o].address_id),1==i[o].is_default&&(n.find(".radio-label").addClass("default-label"),
n.find(".aui-radio").attr("checked",!0),n.find(".radio-label>span").text("默认地址")),n.find(".edit-img").attr("data-id",i[o].address_id),n.find(".del-img").attr("data-id",i[o].address_id),e(".ys-address-list .aui-list").append(n.html())}2==e('input[name="address-state"]').val()&&t.clickItemEvt(),t.changeDefaultAddress(),t.editEvt(),t.delEvt()}else{var d=e('<img src="'+localStorage.localStorage_url+'img_empty.png" />').addClass("empty-img"),s=e("<div />").addClass("empty-text").text("亲，您在哪里呀，快点告诉我们，点击下方按钮去添加取餐地址吧~");e(".ys-address-list .aui-list").append(d,s)}}else alert(a.errmsg)},error:function(t){e(".loading-address").remove(),alert("地址获取失败，请刷新重试")}})}};return{init:t.init}}(jQuery),AddAddress=function(e){var t=new auiToast,a={init:function(){a.getAddressList(),a.addEvt(),clearEvt(e(".ys-add-address .input-del-icon"),e('input[name="add-name"]'))},checkMobile:function(e){var a=e.val();return""==a?(t.fail({title:"请输入手机号",duration:2e3}),e.focus(),!1):!!checkMobileNo(a)||(t.fail({title:"手机号格式不正确",duration:2e3}),e.focus(),!1)},addEvt:function(){e(".ys-add-address .add-address-wrapper>button").click(function(){var r=e(this),i={},o=e('input[name="add-name"]');if(!o.val())return t.fail({title:"订餐人姓名不能为空",duration:2e3}),o.focus(),!1;var n=a.checkMobile(e('input[name="add-tel"]'));if(!n)return!1;var d=e("span.select-sc-address"),s=e("span.select-qc-address");if(void 0==d.attr("data-id"))return t.fail({title:"请选择送餐学校",duration:2e3}),!1;if(i.member_id=localStorage.member_id,i.r_name=o.val(),i.r_mobile=e('input[name="add-tel"]').val(),i.d_id=d.attr("data-id"),i.d_name=d.text(),void 0==s.attr("data-id")||s.attr("data-id")==-1){var c=e(".f-textarea>textarea");if(i.t_id=0,""==c.val())return t.fail({title:"请输入详细送餐地址",duration:2e3}),!1;i.content=c.val()}else i.t_id=s.attr("data-id"),i.t_name=s.text();void 0==e('input[name="is-default"]:checked').val()?i.is_default=2:i.is_default=1;var l=mergeInfo("add_receive_address",i);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(l),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){r.attr("disabled",!0);var t=createDialog();e(".ys-add-address").append(t)},success:function(t){if(e(".zhezhao").remove(),r.removeAttr("disabled"),1==t.errcode){var a="",i="";1==getParams("state")?a=addressUrl[0]:2==getParams("state")&&(a=addressUrl[1],i="&id="+getParams("orderId")),gotoLocation(a,i)}else alert(t.errmsg)},complete:function(){console.log("complete")},error:function(t){e(".zhezhao").remove(),r.removeAttr("disabled")}})})},getAddressList:function(){var t={},a=mergeInfo("get_fd_list",t);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(a),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){var t=createDialog();e(".ys-add-address").append(t)},success:function(t){if(e(".zhezhao").remove(),1==t.errcode){var a=t.data.list;if(a.length){var r=[],i={};for(var o in a){var n={};n.d_id=a[o].d_id,n.d_name=a[o].d_name,r.push(n);var d={};d[-1]="自提点取餐";for(var s in a[o].take_list)d[a[o].take_list[s].t_id]=a[o].take_list[s].t_name;i[a[o].d_id]=d}var c=r[0].d_id;window.localStorage.setItem("school_list",JSON.stringify(r)),window.localStorage.setItem("take_meal_list",JSON.stringify(i));new MobileSelect({trigger:".select-sc-address",title:"",wheels:[{data:r}]}),new MobileSelect({trigger:".select-qc-address",title:"",wheels:[{data:i[c]}]})}}else alert(t.errmsg)},error:function(t){e(".zhezhao").remove(),alert("获取送餐学校失败，请刷新重试")}})}};return{init:a.init}}(jQuery),EditAddress=function(e){var t=new auiToast,a=getParams("id"),r={init:function(){r.getAddressInfo(),r.editClickEvt(),clearEvt(e(".ys-edit-address .input-del-icon"),e('input[name="add-name"]'))},checkMobile:function(e){var a=e.val();return""==a?(t.fail({title:"请输入手机号",duration:2e3}),e.focus(),!1):!!checkMobileNo(a)||(t.fail({title:"手机号格式不正确",duration:2e3}),e.focus(),!1)},editClickEvt:function(){e(".ys-edit-address .add-address-wrapper>button").click(function(){var i=e(this),o={},n=e('input[name="add-name"]');if(!n.val())return t.fail({title:"订餐人姓名不能为空",duration:2e3}),n.focus(),!1;var d=r.checkMobile(e('input[name="add-tel"]'));if(!d)return!1;var s=e("span.select-sc-address"),c=e("span.select-qc-address");if(void 0==s.attr("data-id"))return t.fail({title:"请选择送餐学校",duration:2e3}),!1;if(o.member_id=localStorage.member_id,o.r_name=n.val(),o.r_mobile=e('input[name="add-tel"]').val(),o.d_id=s.attr("data-id"),o.d_name=s.text(),void 0==c.attr("data-id")||c.attr("data-id")==-1){var l=e(".f-textarea>textarea");if(o.t_id=0,""==l.val())return t.fail({title:"请输入详细送餐地址",duration:2e3}),!1;o.content=l.val()}else o.t_id=c.attr("data-id"),o.t_name=c.text();void 0==e('input[name="is-default"]:checked').val()?o.is_default=2:o.is_default=1,o.address_id=a;var u=mergeInfo("edit_receive_address",o);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(u),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){i.attr("disabled",!0);var t=createDialog();e(".ys-add-address").append(t)},success:function(t){if(e(".zhezhao").remove(),i.removeAttr("disabled"),1==t.errcode){var a="",r="";1==getParams("state")?a=addressUrl[0]:2==getParams("state")&&(a=addressUrl[1],r="&id="+getParams("orderId")),gotoLocation(a,r)}else alert(t.errmsg)},complete:function(){console.log("complete")},error:function(t){e(".zhezhao").remove(),i.removeAttr("disabled")}})})},getAddressInfo:function(){var t={member_id:localStorage.member_id,address_id:a},i=mergeInfo("get_address",t);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(i),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){var t=createDialog();e(".ys-edit-address").append(t)},success:function(t){if(e(".zhezhao").remove(),1==t.errcode){var a=t.data;e('input[name="add-name"]').val(a.r_name),e('input[name="add-tel"]').val(a.r_mobile),0==a.t_id||""==a.t_id?(e(".f-textarea>textarea").val(a.content),e(".select-qc-address").attr("data-id","-1").text("自提点取餐")):e(".address-textarea").addClass("aui-hide"),1==a.is_default&&e('input[name="is-default"]').attr("checked",!0),r.getSchoolList(a)}else alert(t.errmsg)},error:function(t){e(".zhezhao").remove(),alert("网络错误，请刷新重试")}})},getSchoolList:function(t){var a={},r=mergeInfo("get_fd_list",a);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(r),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){},success:function(a){if(1==a.errcode){var r=a.data.list;if(r.length){var i,o=[],n={},d=0;for(var s in r){var c={};c.d_id=r[s].d_id,c.d_name=r[s].d_name,o.push(c),r[s].d_id==t.d_id&&(i=s,e(".select-sc-address").attr("data-id",t.d_id).text(r[s].d_name));var l={};l[-1]="自提点取餐";for(var u in r[s].take_list)l[r[s].take_list[u].t_id]=r[s].take_list[u].t_name,r[s].take_list[u].t_id==t.t_id&&(d=u,e(".select-qc-address").attr("data-id",t.t_id).text(r[s].take_list[u].t_name));n[r[s].d_id]=l}var p=o[i].d_id;window.localStorage.setItem("school_list",JSON.stringify(o)),window.localStorage.setItem("take_meal_list",JSON.stringify(n));new MobileSelect({trigger:".select-sc-address",title:"",wheels:[{data:o}],position:[i]}),new MobileSelect({trigger:".select-qc-address",title:"",wheels:[{data:n[p]}],position:[d]})}}else alert(a.errmsg)},error:function(e){alert("获取送餐学校失败，请刷新重试")}})}};return{init:r.init}}(jQuery),User=function(e){var t={init:function(){t.defaultSelected(),t.selectSexEvt(),t.saveUser()},saveUser:function(){e(".edit-user-wrapper>button").click(function(){var t=e(this),a={member_id:localStorage.member_id,sex:e(".selected").attr("data-sex")},r=mergeInfo("change_member_sex",a);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(r),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){var t=createDialog();e(".ys-myaccount-edit").append(t)},success:function(a){e(".zhezhao").remove(),1==a.errcode?gotoLocation(t.attr("data-url"),""):alert(a.errmsg)},error:function(t){e(".zhezhao").remove(),alert("用户信息保存失败，请刷新重试")}})})},defaultSelected:function(){var t=localStorage.username,a=localStorage.sex;e(".username").text(t),e(".sex-select").each(function(){e(this).attr("data-sex")==a&&e(this).addClass("selected")})},selectSexEvt:function(){e(".sex-select").click(function(){e(".sex-select").removeClass("selected"),e(this).addClass("selected")})}};return{init:t.init}}(jQuery),Register=function(e){var t=new auiToast,a={init:function(){clearEvt(e(".ys-register .input-del-icon"),e(".user-mobile")),a.getVerCode(),a.checkRegisterInfo()},checkMobile:function(a){return e(".ys-mob-item").removeClass("error-info"),""==a?(t.fail({title:"请输入手机号",duration:2e3}),e(".user-mobile").focus(),e(".ys-mob-item").addClass("error-info"),!1):!!checkMobileNo(a)||(t.fail({title:"手机号格式不正确",duration:2e3}),e(".user-mobile").focus(),e(".ys-mob-item").addClass("error-info"),!1)},checkCode:function(a){return e(".ys-code-item").removeClass("error-info"),""==a?(t.fail({title:"请输入验证码",duration:2e3}),e(".verify").focus(),e(".ys-code-item").addClass("error-info"),!1):!(a.length<6)||(t.fail({title:"验证码格式不正确",duration:2e3}),e(".verify").focus(),e(".ys-code-item").addClass("error-info"),!1)},checkRegisterInfo:function(){e(".ys-register .next-btn").bind("click",function(){var t=e(this),r=e(".user-mobile").val(),i=e(".verify").val(),o=a.checkMobile(r);if(o){var n=a.checkCode(i);if(n){var d={mobile:r,seccode:i},s=mergeInfo("reg_check",d);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(s),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){t.attr("disabled",!0)},success:function(a){if(1==a.errcode){var i=e(".name").val(),o=e(".openid").val(),n=e(".avatar").val(),d={nickName:i,openid:o,avatar:n,mob:r};window.localStorage.setItem("user_info",JSON.stringify(d)),gotoLocation(e(".question-url").val(),"")}else alert(a.errmsg);t.removeAttr("disabled")},complete:function(){console.log("complete")},error:function(e){t.removeAttr("disabled")}})}}})},getVerCode:function(){e(".ys-register .get-verify-btn").bind("click",function(){var r=e(this),i=e(".user-mobile").val(),o=a.checkMobile(i);if(o){var n={mobile:i},d=mergeInfo("send_seccode",n);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(d),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){r.attr("disabled",!0)},success:function(e){if(1==e.errcode){r.css("background-color","#ccc");var a=new Date;a.setSeconds(a.getSeconds()+59);var i=a.getMonth()+1,o=a.getFullYear()+"-"+i+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds(),n=new Date(Date.parse(o.replace(/-/g,"/"))).getTime(),d=(n-(new Date).getTime())/1e3,s=setInterval(function(){if(d>1){d-=1;var e=Math.floor(d/3600/24),t=Math.floor(d/3600%24),a=Math.floor(d/60%60),i=Math.floor(d%60),o="";e>0&&(o+=e+"天"),t>0&&(t<10&&(t="0"+t),o+=t+"小时"),a>0&&(a<10&&(a="0"+a),o+=a+"分"),i>0&&(i<10&&(i="0"+i),o+=i+"秒"),r.text(o)}else clearInterval(s),r.attr("disabled",!1),r.text("重新获取验证码"),r.css("background-color","#fa5400")},1e3)}else t.fail({title:"获取验证码失败",duration:2e3}),r.attr("disabled",!1)},complete:function(){console.log("complete")},error:function(e){console.log("error:"+e),r.attr("disabled",!1)}})}})}};return{init:a.init}}(jQuery),Question=function(e){var t={init:function(){t.changeRedioEvt(e('input.aui-radio[name="radio1"]')),t.changeRedioEvt(e('input.aui-radio[name="radio2"]')),t.changeRedioEvt(e('input.aui-radio[name="radio3"]')),t.changeRedioEvt(e('input.aui-radio[name="radio4"]')),t.registerEvt()},changeRedioEvt:function(t){var a=t;a.change(function(){a.parent(".radio-label").removeClass("default-label"),e(this).parent(".radio-label").addClass("default-label")})},registerEvt:function(){e(".ys-register-question .question-sub-btn").bind("click",function(){var t=e(this),a=JSON.parse(localStorage.user_info),r=e('input.aui-radio[name="radio1"]:checked').val(),i=e('input.aui-radio[name="radio2"]:checked').val(),o=e('input.aui-radio[name="radio3"]:checked').val(),n=e('input.aui-radio[name="radio4"]:checked').val(),d=a.mob,s=a.nickName,c=a.openid,l=a.avatar,u={mobile:d,openid:c,avatar:l,nick_name:s,question:{q1:r,q2:i,q3:o,q4:n}},p=mergeInfo("reg_member",u);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(p),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){t.attr("disabled",!0);var a=e(".localStorage-url").val(),r=e("<div />").addClass("zhezhao"),i=e("<img />").attr("src",a+"loading.gif");r.append(i),e(".ys-register-question").append(r)},success:function(a){e(".zhezhao").remove(),t.removeAttr("disabled"),1==a.errcode?(window.localStorage.setItem("member_id",a.data.member_id),gotoLocation(e(".ys-register-question .home-url").val(),"")):console.log(a.errmsg)},error:function(a){e(".zhezhao").remove(),t.removeAttr("disabled")}})})}};return{init:t.init}}(jQuery),Shoppingcar=function(e){var t=new auiDialog,a={init:function(e){a.getCarList(e),a.gotoReserveEvt(),a.gotoDelCar(),a.delcarEvt()},gotoReserveEvt:function(){e(".go-pay-btn").click(function(){var t=e(this),r=e('input[name="itemRadio"]:checked').length;if(r){var i,o={},n=[],d=!0;if(e('input[name="itemRadio"]:checked').each(function(t){if(o[t]=e(this).attr("data-sku"),i=e(this).attr("time-state"),0==t)n.push(i);else if("-1"==e.inArray(i,n))return alert("亲，请选择相同时间段的商品"),d=!1,!1}),d){var s={};s.sku_ids=o,a.createGoodsOrder(s,t.attr("data-url"))}}else alert("亲，还没有等待结算的商品呢")})},createGoodsOrder:function(t,a){t.member_id=localStorage.member_id;var r=mergeInfo("create_goods_order",t);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(r),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){var t=createDialog();e(".ys-product-detail").append(t)},success:function(t){e(".zhezhao").remove(),1==t.errcode?(window.localStorage.setItem("orderData",JSON.stringify(t.data)),gotoLocation(a,"&payState=2")):alert(t.errmsg)},error:function(t){e(".zhezhao").remove(),alert("网络错误，请刷新重试")}})},gotoDelCar:function(){e(".ys-edit-text").click(function(){gotoLocation(e(this).attr("data-url"),"")})},checkAll:function(){e('input[name="checkAll"]').click(function(){if(this.checked){var t=e('.good-list input[name="itemRadio"]').length,a=0;e('.good-list input[name="itemRadio"]').prop("checked",!0),e('.good-list input[name="itemRadio"]').each(function(){a=accAdd(a,e(this).attr("data-price"))}),e(".total-value").text(a),e(".pay-num").text(t)}else e('input[name="itemRadio"]').prop("checked",!1),e(".total-value").text("0.00"),e(".pay-num").text("0")})},delcarEvt:function(){e(".del-shop-item, .delete-spcar-btn").bind("click",function(){var a=e('input[name="itemRadio"]:checked').length;a?t.alert({title:"温馨提示",msg:"是否删除所选商品",buttons:["取消","确定"]},function(t){if(2==t.buttonIndex){var a={};e('input[name="itemRadio"]:checked').each(function(t){a[t]=e(this).attr("data-sku")});var r={member_id:localStorage.member_id,sku_ids:a},i=mergeInfo("del_cart",r);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(i),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){var t=createDialog();e(".ys-shopping-car").append(t)},success:function(t){e(".zhezhao").remove(),1==t.errcode?window.location.reload():alert(t.errmsg)},error:function(t){e(".zhezhao").remove(),alert("网络错误， 请刷新重试")}})}}):alert("主人，还没有商品等您删除呢")})},itemSelectEvt:function(){e('input[name="itemRadio"]').change(function(){var t=e(".total-value").text(),a=e(".pay-num").text();this.checked?(t=accAdd(t,e(this).attr("data-price")),a++):(t=accSub(t,e(this).attr("data-price")),a--,e('input[name="checkAll"]')[0].checked&&e('input[name="checkAll"]').prop("checked",!1)),e(".total-value").text(t),e(".pay-num").text(a)})},getCarList:function(t){var r={member_id:localStorage.member_id},i=mergeInfo("get_cart_list",r);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(i),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){var t=createDialog();e(".ys-shopping-car").append(t)},success:function(r){if(e(".zhezhao").remove(),1==r.errcode){var i=r.data.list;if(e(".good-list").css("background-color"," #fff"),i.length){for(var o in i){var n,d=e(".copy-item").clone(!0),s=i[o].delivery_time,c="";if(2==s.length)c="含中、晚餐",n=1;else{var l=s[0];c=1==l?"含中餐":"含晚餐",n=1==l?2:3}if(1==t&&2==i[o].goods_state?d.find('input[name="itemRadio"]').addClass("aui-invisible").removeAttr("name"):d.find('input[name="itemRadio"]').attr({"data-price":i[o].sku_price,"data-spu":i[o].spu_id,"data-sku":i[o].sku_id,"time-state":n}),2==i[o].goods_state){d.children("li.aui-list-item").addClass("invalid-item");var u=e('<div class="invalid-mask" />'),p=e('<div class="invalid-text" />').text("已失效");d.find(".good-img").after(u,p)}d.find(".delivery_time").text(c),d.find(".good-img").attr("src",i[o].goods_img),d.find(".good-name").text(i[o].goods_name),d.find(".good-price").text(i[o].sku_price),d.find(".good-price-area").text(i[o].spec),e(".good-list").append(d.html())}a.checkAll(),a.itemSelectEvt()}else{var f=e('<img src="'+localStorage.localStorage_url+'img_empty.png" />').addClass("empty-img"),m=e("<div />").addClass("empty-text").text("亲，购物车空瘪瘪的，赶快去添加商品吧");e(".ys-shopping-car .good-list").append(f,m).css("background-color","#f5f5f5")}}else alert(r.errmsg)},error:function(){e(".zhezhao").remove(),alert("网络错误，请刷新重试")}})}};return{init:a.init}}(jQuery),Coupon=function(){var e,t=[1,2],a={1:"未使用",2:"已使用",3:"已失效"},r={init:function(){e=$('input[name="member_id"]').val(),e?localStorage.setItem("member_id",e):e=localStorage.member_id,r.getCouponList(t[0]),r.tabSelectEvt()},tabSelectEvt:function(){new auiTab({element:document.getElementById("tab")},function(e){if(e){var t=e.index;r.getCouponList(t)}})},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},getCouponList:function(t){var i={member_id:e,state:t},o=mergeInfo("get_member_voucher",i);$.ajax({type:"POST",url:apiUrl,data:JSON.stringify(o),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){$(".ys-coupon .aui-list").children().remove();var e=createLoadDom("coupon");$(".ys-coupon .aui-list").append(e)},success:function(e){$(".loading-coupon").remove();var i=e.errcode;if(1==i){var o=e.data;if(r.isEmptyObject(o)){var n=$('<img src="'+localStorage.localStorage_url+'img_empty.png" />').addClass("empty-img"),d=$("<div />").addClass("empty-text").text("亲，你还未拥有优惠券哦");$(".ys-coupon .aui-list").append(n,d)}else{var s=o.list;for(var c in s){var l=$(".copy-item").clone(!0),u="";if(l.find(".voucher_price").text(s[c].voucher_price),1==s[c].voucher_type)u="全店配餐均可使用";else if(2==s[c].voucher_type){var p=s[c].goods_info;u="仅限于";for(var f in p)u+=f==p.length-1?p[f].goods_name:p[f].goods_name+"、"}if(l.find(".coupon-range").text(s[c].voucher_name),l.find(".coupon-limit-info").text(u),l.find(".coupon-start-date").text(s[c].start_time),l.find(".coupon-end-date").text(s[c].end_time),2==t){var m=$('<p class="coupon-state" />').text(a[s[c].state]);l.find(".coupon-limit").after(m),l.find(".coupon-demonation,.coupon-limit, .coupon-range, .coupon-limit-info, .coupon-limit-date-title, .coupon-limit-date").addClass("disabled")}$(".ys-coupon .aui-list").append(l.html())}}}else alert(e.errmsg)},error:function(e){$(".loading-coupon").remove(),alert("网络错误，请刷新重试")}})}};return{init:r.init}}(jQuery),Refund=function(e){var t={init:function(){t.jumpToApply()},jumpToApply:function(){e(".apply-refund-btn").click(function(){gotoLocation(e(this).attr("data-url"),"")})},tabSelectEvt:function(){e("#footer>.aui-bar-tab-item").bind("click",function(t){if(!e(this).hasClass("aui-active")){var a=e(this).index();gotoLocation(urlArr[a],"")}})}};return{init:t.init}}(jQuery),OrderSuccess=function(e){var t={init:function(){e(".order-no").text(getParams("order_sn")),e(".see-order-btn").click(function(){gotoLocation(e(this).attr("data-url"),"")})}};return{init:t.init}}(jQuery),WXpay=function(e){var t={init:function(){t.changeOrderState()},changeOrderState:function(){var t=getParams("order_sn"),a={order_sn:t},r=mergeInfo("change_temp_order_state",a);e.ajax({type:"POST",url:apiUrl,data:JSON.stringify(r),dataType:"json",contentType:"application/json; charset=utf-8",beforeSend:function(){},success:function(e){},error:function(e){}})}};return{init:t.init}}(jQuery),Footer=function(e){var t={init:function(){t.tabSelectEvt()},tabSelectEvt:function(){e("#footer>.aui-bar-tab-item").bind("click",function(t){if(!e(this).hasClass("aui-active")){var a=e(this).index();gotoLocation(urlArr[a],"")}})}};return{init:t.init}}(jQuery);
//# sourceMappingURL=common.js.map
