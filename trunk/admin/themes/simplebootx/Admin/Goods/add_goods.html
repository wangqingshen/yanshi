<admintpl file="header" />
</head>
<body>
	<div class="wrap js-check-wrap">
		<ul class="nav nav-tabs">
			<li><a href="{:U('Goods/goods_list')}">商品列表</a></li>
			<li class="active"><a href="#">添加商品</a></li>
		</ul>
		<div>
			<form id="goods_form" class="form-horizontal" method="post" action="{:U('Goods/add_goods_post')}">
				<fieldset>
					<div class="control-group">
						<label class="control-label"><span style="color: red">*</span>商品名称:</label>
						<div class="controls">
							<input type="text" name="goods_name" id="goods_name" />
						</div>
					</div>
					<div class="control-group">
						<label class="control-label"><span style="color: red">*</span>商品分类:</label>
						<div class="controls">
							<select id="select_gooods_class" name="select_gooods_class">
								<option value="">请选择</option>
								<option value="1">健身餐</option>
								<option value="2">健康餐</option>
								<option value="3">沙拉</option>
								<option value="4">饮品</option>
								<option value="5">零食</option>
							</select>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label"><span style="color: red">*</span>送餐说明:</label>
						<div class="controls">
							<textarea id="delivery_explain" name="delivery_explain"></textarea>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label"><span style="color: red">*</span>商品主图:</label>
						<br />
						<div class="span2">
							<table class="table table-bordered">
								<tr>
									<td>
										<div style="text-align: center;">
											<input type="hidden" name="goods_img1" id="thumb" value="">
											<a href="javascript:upload_one_image('图片上传','#thumb',300,'goods');">
												<img src="__TMPL__Public/assets/images/default-thumbnail.png" id="thumb-preview" width="135" style="cursor: hand;width: 120px;height: 120px" />
											</a>
											<input type="button" class="btn btn-small" onclick="$('#thumb-preview').attr('src','__TMPL__Public/assets/images/default-thumbnail.png');$('#thumb').val('');return false;" value="取消图片">
										</div>
									</td>
								</tr>
							</table>
						</div>
						<label style="color: red;position: relative;right: 140px;top:165px;font-size: 10px;">(建议使用800*800像素、大小不超过300k的正方形图片)</label>
					</div>
					<div class="control-group">
						<label class="control-label">商品轮播图片:</label>
						<div class="span2">
							<table class="table table-bordered">
								<tr>
									<td>
										<div style="text-align: center;">
											<input type="hidden" name="goods_slide_img[]" id="thumb-slide-1" value="">
											<a href="javascript:upload_one_image('图片上传','#thumb-slide-1',300,'goods');">
												<img src="__TMPL__Public/assets/images/default-thumbnail.png" id="thumb-slide-1-preview" style="cursor: hand;width: 120px;height: 120px" />
											</a>
											<input type="button" class="btn btn-small" onclick="$('#thumb-slide-1-preview').attr('src','__TMPL__Public/assets/images/default-thumbnail.png');$('#thumb-1').val('');return false;" value="取消图片">
										</div>
									</td>
								</tr>
							</table>

						</div>
						<div class="span2">
							<table class="table table-bordered">
								<tr>
									<td>
										<div style="text-align: center;">
											<input type="hidden" name="goods_slide_img[]" id="thumb-slide-2" value="">
											<a href="javascript:upload_one_image('图片上传','#thumb-slide-2',300,'goods');">
												<img src="__TMPL__Public/assets/images/default-thumbnail.png" id="thumb-slide-2-preview" style="cursor: hand;width: 120px;height: 120px" />
											</a>
											<input type="button" class="btn btn-small" onclick="$('#thumb-slide-2-preview').attr('src','__TMPL__Public/assets/images/default-thumbnail.png');$('#thumb-2').val('');return false;" value="取消图片">
										</div>
									</td>
								</tr>
							</table>
						</div>
						<div class="span2">
							<table class="table table-bordered">
								<tr>
									<td>
										<div style="text-align: center;">
											<input type="hidden" name="goods_slide_img[]" id="thumb-slide-3" value="">
											<a href="javascript:upload_one_image('图片上传','#thumb-slide-3',300,'goods');">
												<img src="__TMPL__Public/assets/images/default-thumbnail.png" id="thumb-slide-3-preview" style="cursor: hand;width: 120px;height: 120px" />
											</a>
											<input type="button" class="btn btn-small" onclick="$('#thumb-slide-3-preview').attr('src','__TMPL__Public/assets/images/default-thumbnail.png');$('#thumb-3').val('');return false;" value="取消图片">
										</div>
									</td>
								</tr>
							</table>
						</div>
						<div class="span2">
							<table class="table table-bordered">
								<tr>
									<td>
										<div style="text-align: center;">
											<input type="hidden" name="goods_slide_img[]" id="thumb-slide-4" value="">
											<a href="javascript:upload_one_image('图片上传','#thumb-slide-4',300,'goods');">
												<img src="__TMPL__Public/assets/images/default-thumbnail.png" id="thumb-slide-4-preview" style="cursor: hand;width: 120px;height: 120px" />
											</a>
											<input type="button" class="btn btn-small" onclick="$('#thumb-slide-4-preview').attr('src','__TMPL__Public/assets/images/default-thumbnail.png');$('#thumb-4').val('');return false;" value="取消图片">
										</div>
									</td>
								</tr>
							</table>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">商品详情图片:</label>
						<div class="span2">
							<table class="table table-bordered">
								<tr>
									<td>
										<div style="text-align: center;">
											<input type="hidden" name="goods_spu_img[]" id="thumb-1" value="">
											<a href="javascript:upload_one_image('图片上传','#thumb-1',300,'goods');">
												<img src="__TMPL__Public/assets/images/default-thumbnail.png" id="thumb-1-preview" style="cursor: hand;width: 120px;height: 120px" />
											</a>
											<input type="button" class="btn btn-small" onclick="$('#thumb-1-preview').attr('src','__TMPL__Public/assets/images/default-thumbnail.png');$('#thumb-1').val('');return false;" value="取消图片">
										</div>
									</td>
								</tr>
							</table>

						</div>
						<div class="span2">
							<table class="table table-bordered">
								<tr>
									<td>
										<div style="text-align: center;">
											<input type="hidden" name="goods_spu_img[]" id="thumb-2" value="">
											<a href="javascript:upload_one_image('图片上传','#thumb-2',300,'goods');">
												<img src="__TMPL__Public/assets/images/default-thumbnail.png" id="thumb-2-preview" style="cursor: hand;width: 120px;height: 120px" />
											</a>
											<input type="button" class="btn btn-small" onclick="$('#thumb-2-preview').attr('src','__TMPL__Public/assets/images/default-thumbnail.png');$('#thumb-2').val('');return false;" value="取消图片">
										</div>
									</td>
								</tr>
							</table>
						</div>
						<div class="span2">
							<table class="table table-bordered">
								<tr>
									<td>
										<div style="text-align: center;">
											<input type="hidden" name="goods_spu_img[]" id="thumb-3" value="">
											<a href="javascript:upload_one_image('图片上传','#thumb-3',300,'goods');">
												<img src="__TMPL__Public/assets/images/default-thumbnail.png" id="thumb-3-preview" style="cursor: hand;width: 120px;height: 120px" />
											</a>
											<input type="button" class="btn btn-small" onclick="$('#thumb-3-preview').attr('src','__TMPL__Public/assets/images/default-thumbnail.png');$('#thumb-3').val('');return false;" value="取消图片">
										</div>
									</td>
								</tr>
							</table>
						</div>
						<div class="span2">
							<table class="table table-bordered">
								<tr>
									<td>
										<div style="text-align: center;">
											<input type="hidden" name="goods_spu_img[]" id="thumb-4" value="">
											<a href="javascript:upload_one_image('图片上传','#thumb-4',300,'goods');">
												<img src="__TMPL__Public/assets/images/default-thumbnail.png" id="thumb-4-preview" style="cursor: hand;width: 120px;height: 120px" />
											</a>
											<input type="button" class="btn btn-small" onclick="$('#thumb-4-preview').attr('src','__TMPL__Public/assets/images/default-thumbnail.png');$('#thumb-4').val('');return false;" value="取消图片">
										</div>
									</td>
								</tr>
							</table>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label"><span style="color: red">*</span>分类推荐:</label>
						<div class="controls">
							<input type="radio" name="is_recommend" checked="checked" value="1"/>否
							<input type="radio" name="is_recommend" value="2"/>是

						</div>
					</div>
					<div class="control-group" style="display: none" id="div_goods_class">
						<label class="control-label"><span style="color: red">*</span>商品分类推荐图:</label>
						<br />
						<div class="span2">
							<table class="table table-bordered">
								<tr>
									<td>
										<div style="text-align: center;">
											<input type="hidden" name="goods_class_img" id="thumb-5" value="">
											<a href="javascript:upload_one_image('图片上传','#thumb-5',300,'goods');">
												<img src="__TMPL__Public/assets/images/default-thumbnail.png" id="thumb-5-preview" width="135" style="cursor: hand;width: 120px;height: 120px" />
											</a>
											<input type="button" class="btn btn-small" onclick="$('#thumb-5-preview').attr('src','__TMPL__Public/assets/images/default-thumbnail.png');$('#thumb-5').val('');return false;" value="取消图片">
										</div>
									</td>
								</tr>
							</table>
						</div>
						<label style="color: red;position: relative;right: 140px;top:165px;font-size: 10px;">(建议使用750*350像素、大小不超过300k的图片)</label>
					</div>
					<div class="control-group">
						<label class="control-label"><span style="color: red">*</span>商品送餐时间:</label>
						<div class="controls">
							<input type="checkbox" name="delivery_time[]" value="1"/>中午
							<input type="checkbox" name="delivery_time[]" value="2"/>晚上
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">商品规格:</label>
						<div class="controls">
							<table class="table table-bordered">
								<tr>
									<td style="width: 20px;">份量</td>
									<volist name="portion" id="vo">
									<td style="width: 80px;color: black;text-align: center;font-size: 14px;" class="sp_name">
										<label><input name="portion" type="checkbox" value="{$vo.id}|{$vo.spec_value}" />{$vo.spec_value}</label>
									</td>
									</volist>
								</tr>
								<tr>
									<td style="width: 20px;">周期</td>
									<volist name="cycle" id="vo">
										<td style="width: 80px;color: black;text-align: center;font-size: 14px;" class="sp_name">
											<label><input name="cycle" type="checkbox" value="{$vo.id}|{$vo.spec_value}" />{$vo.spec_value}</label>
										</td>
									</volist>
								</tr>
							</table>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">sku商品信息:</label>
						<div class="controls">
							<table class="table table-hover table-bordered">
								<thead>
								<tr>
									<th>SKU名称</th>
									<th>商品单价</th>
									<th>二人拼团价</th>
									<th>四人拼团价</th>
									<th>送餐次数</th>
								</tr>
								</thead>
								<tbody id="sku_table"></tbody>
							</table>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label"><span style="color: red">*</span>发布状态:</label>
						<div class="controls">
							<input type="radio" name="spu_state" checked="checked" value="1"/>上架
							<input type="radio" name="spu_state" value="2"/>下架

						</div>
					</div>
				</fieldset>
				<div class="form-actions">
					<button type="submit" class="btn btn-primary js-ajax-submit" id="submit_btn">创建商品</button>
					<a class="btn" href="javascript:history.back(-1);">返回</a>
				</div>

			</form>
		</div>
	</div>
	<script src="__PUBLIC__/js/common.js"></script>
	<script src="__PUBLIC__/js/validate.js"></script>
	<script>
		$(function () {
			$("input[name='portion'], input[name='cycle']").on('click', function(){
				// 移除之前生成好的sku表格
				$('#sku_table').html('');
				//判断规格个数
				var p_len = $("input[name='portion']:checkbox:checked").length;
				var c_len = $("input[name='cycle']:checkbox:checked").length;
				//为生成的规格生成sku表格
				var html = '';
				if(p_len == 0 || c_len == 0) {
					console.log('无需操作');
				}else if (p_len == 1 && c_len == 1) {
					//规格名称
					var p_name = $("input[name='portion']:checkbox:checked").val().split('|');
					var c_name = $("input[name='cycle']:checkbox:checked").val().split('|');
					var _name = p_name[1] + '|' + c_name[1];
					html += "<tr>";
					html += "<td>"+p_name[1]+'&nbsp;&nbsp;&nbsp;&nbsp;'+c_name[1]+"</td>";
					html += "<td><input type='text' name='spec["+_name+"][]' value='' /></td>";
					html += "<td><input type='text' name='spec["+_name+"][]' value='' /></td>";
					html += "<td><input type='text' name='spec["+_name+"][]' value='' /></td>";
					html += "<td><input style='width: 50px;' type='text' name='spec["+_name+"][]' value='' /></td>";
					html += "</tr>";
				}else if(p_len >= 1 || c_len >= 1) {
					$("input[name='portion']:checkbox:checked").each(function () {
						var _that = $(this);
						$("input[name='cycle']:checkbox:checked").each(function () {
							var _this = $(this);
							var p_name = _that.val().split('|'),
								c_name = _this.val().split('|');
							var _name = p_name[1] + '|' + c_name[1];
							html += "<tr>";
							html += "<td>"+p_name[1]+'&nbsp;&nbsp;&nbsp;&nbsp;'+c_name[1]+"</td>";
							html += "<td><input type='text' name='spec["+_name+"][]' value='' /></td>";
							html += "<td><input type='text' name='spec["+_name+"][]' value='' /></td>";
							html += "<td><input type='text' name='spec["+_name+"][]' value='' /></td>";
							html += "<td><input style='width: 50px;' type='text' name='spec["+_name+"][]' value='' /></td>";
							html += "</tr>";
						});
					});
				}
				$('#sku_table').append(html);
			});


			$('input[name="is_recommend"]').change(function () {
				var check = $(this).val();
				if(check == 1){
					$('#div_goods_class').hide();
				}else if(check == 2){
					$('#div_goods_class').show();
				}
			})
			$('#goods_form').validate({
				rules:{
					goods_name:{
						required: true,
						maxlength: 50
					},
					select_gooods_class:{
						required: true
					},
					delivery_explain:{
						required: true,
						maxlength: 500
					},
					goods_img1:{
						required: true
					}
				},
				messages:{
					goods_name:{
						required: "<span style='color: red'>商品名称不能为空</span>",
						maxlength: "<span style='color: red'>商品名称的最大长度为50字</span>"
					},
					select_gooods_class:{
						required: "<span style='color: red'>请选择商品分类</span>",
					},
					delivery_explain:{
						required: "<span style='color: red'>必须填写送餐说明</span>",
						maxlength: "<span style='color: red'>送餐说明不得超过500字</span>"
					},
					goods_img1:{
						required: "<span style='color: red'>必须上传商品主图</span>",
					}
				}
			});

			$('#back').click(function () {
				history.go(-1);
			});

		});
	</script>
</body>
</html>