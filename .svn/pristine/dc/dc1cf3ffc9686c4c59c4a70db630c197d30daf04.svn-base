{"version":3,"sources":["aui/aui-pull-refresh.js"],"names":["window","touchYDelta","translateVal","firstTouchY","initialScroll","auiPullToRefresh","params","callback","this","extend","_init","isLoading","docElem","document","documentElement","win","width","innerWidth","height","innerHeight","isMoved","prototype","container","querySelector","friction","triggerDistance","self","loadingHtml","insertAdjacentHTML","addEventListener","ev","touchStart","touchMove","touchEnd","style","webkitTransitionDuration","transitionDuration","touchobj","changedTouches","parseInt","clientY","scrollY","preventDefault","moving","touchY","Math","pow","webkitTransform","transform","classList","add","remove","throttle","status","cancelLoading","pageYOffset","scrollTop","fn","delay","allowSample","e","setTimeout","winresize","resize","a","b","key","hasOwnProperty"],"mappings":"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","file":"aui-pull-refresh.js","sourcesContent":["/**\r\n * aui-pull-refresh.js\r\n * @author 流浪男\r\n * @todo more things to abstract, e.g. Loading css etc.\r\n * Licensed under the MIT license.\r\n * http://www.opensource.org/licenses/mit-license.php\r\n */\r\n(function(window) {\r\n\t'use strict';\r\n\t/**\r\n\t * Extend obj function\r\n\t *\r\n\t * This is an object extender function. It allows us to extend an object\r\n\t * by passing in additional variables and overwriting the defaults.\r\n\t */\r\n\tvar auiPullToRefresh = function (params,callback) {\r\n\t\tthis.extend(this.params, params);\r\n\t\tthis._init(callback);\r\n\t}\r\n\tvar touchYDelta;\r\n\tvar isLoading = false;\r\n\tvar docElem = window.document.documentElement,\r\n\t\tloadWrapH,\r\n\t\twin = {width: window.innerWidth, height: window.innerHeight},\r\n\t\twinfactor= 0.2,\r\n\t\ttranslateVal,\r\n\t\tisMoved = false,\r\n\t\tfirstTouchY, initialScroll;\r\n\tauiPullToRefresh.prototype = {\r\n\t\tparams: {\r\n            container: document.querySelector('.aui-refresh-content'),\r\n\t\t\tfriction: 2.5,\r\n\t\t\ttriggerDistance: 100,\r\n\t\t\tcallback:false\r\n        },\r\n        _init : function(callback) {\r\n\t\t\tvar self = this;\r\n\t\t\tvar loadingHtml = '<div class=\"aui-refresh-load\"><div class=\"aui-refresh-pull-arrow\"></div></div>';\r\n\t\t\tself.params.container.insertAdjacentHTML('afterbegin', loadingHtml);\r\n\t\t\tself.params.container.addEventListener('touchstart', function(ev){\r\n\t\t\t\tself.touchStart(ev)\r\n\t\t\t});\r\n\t\t\tself.params.container.addEventListener('touchmove', function(ev){\r\n\t\t\t\tself.touchMove(ev)\r\n\t\t\t});\r\n\t\t\tself.params.container.addEventListener('touchend', function(ev){\r\n\t\t\t\tself.touchEnd(ev,callback);\r\n\t\t\t});\r\n\t\t},\r\n\t\ttouchStart : function(ev) {\r\n\t\t\t// this.params.container.classList.remove(\"refreshing\");\r\n\t\t\tif (isLoading) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tisMoved = false;\r\n\t\t\tthis.params.container.style.webkitTransitionDuration =\r\n\t\t    this.params.container.style.transitionDuration = '0ms';\r\n\t\t\ttouchYDelta = '';\r\n\t\t\tvar touchobj = ev.changedTouches[0];\r\n\t\t\t// register first touch \"y\"\r\n\t\t\tfirstTouchY = parseInt(touchobj.clientY);\r\n\t\t\tinitialScroll = this.scrollY();\r\n\t\t},\r\n\t\ttouchMove : function (ev) {\r\n\t\t\tif (isLoading) {\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar self = this;\r\n\t\t\tvar moving = function() {\r\n\t\t\t\tvar touchobj = ev.changedTouches[0], // reference first touch point for this event\r\n\t\t\t\t\ttouchY = parseInt(touchobj.clientY);\r\n\t\t\t\t\ttouchYDelta = touchY - firstTouchY;\r\n\t\t\t\tif ( self.scrollY() === 0 && touchYDelta > 0  ) {\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t\tif ( initialScroll > 0 || self.scrollY() > 0 || self.scrollY() === 0 && touchYDelta < 0 ) {\r\n\t\t\t\t\tfirstTouchY = touchY;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\ttranslateVal = Math.pow(touchYDelta, 0.85);\r\n\t\t\t\tself.params.container.style.webkitTransform = self.params.container.style.transform = 'translate3d(0, ' + translateVal + 'px, 0)';\r\n\t\t\t\tisMoved = true;\r\n\t\t\t\tif(touchYDelta > self.params.triggerDistance){\r\n\t\t\t\t\tself.params.container.classList.add(\"aui-refresh-pull-up\");\r\n\t\t\t\t\tself.params.container.classList.remove(\"aui-refresh-pull-down\");\r\n\t\t\t\t}else{\r\n\t\t\t\t\tself.params.container.classList.add(\"aui-refresh-pull-down\");\r\n\t\t\t\t\tself.params.container.classList.remove(\"aui-refresh-pull-up\");\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tthis.throttle(moving(), 20);\r\n\t\t},\r\n\t\ttouchEnd : function (ev,callback) {\r\n\t\t\tvar self =this;\r\n\t\t\tif (isLoading|| !isMoved) {\r\n\t\t\t\tisMoved = false;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// 根据下拉高度判断是否加载\r\n\t\t\tif( touchYDelta >= this.params.triggerDistance) {\r\n\t\t\t\tisLoading = true; //正在加载中\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t\tthis.params.container.style.webkitTransitionDuration =\r\n\t\t    \tthis.params.container.style.transitionDuration = '300ms';\r\n\t\t\t\tthis.params.container.style.webkitTransform =\r\n\t\t\t\tthis.params.container.style.transform = 'translate3d(0,60px,0)';\r\n\t\t\t\tdocument.querySelector(\".aui-refresh-pull-arrow\").style.webkitTransitionDuration =\r\n\t\t    \tdocument.querySelector(\".aui-refresh-pull-arrow\").style.transitionDuration = '0ms';\r\n\t\t\t\tself.params.container.classList.add(\"aui-refreshing\");\r\n\t\t\t\tif(callback){\r\n\t\t\t\t\tcallback({\r\n\t\t\t\t\t\tstatus:\"success\"\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tthis.params.container.style.webkitTransitionDuration =\r\n\t\t    \tthis.params.container.style.transitionDuration = '300ms';\r\n\t\t\t\tthis.params.container.style.webkitTransform =\r\n\t\t\t\tthis.params.container.style.transform = 'translate3d(0,0,0)';\r\n\t\t\t\tif(callback){\r\n\t\t\t\t\tcallback({\r\n\t\t\t\t\t\tstatus:\"fail\"\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tisMoved = false;\r\n\t\t\treturn;\r\n\t\t},\r\n\t\tcancelLoading : function () {\r\n\t\t\tvar self =this;\r\n\t\t\tisLoading = false;\r\n\t\t\tself.params.container.classList.remove(\"aui-refreshing\");\r\n\t\t\tdocument.querySelector(\".aui-refresh-pull-arrow\").style.webkitTransitionDuration =\r\n\t\t    \tdocument.querySelector(\".aui-refresh-pull-arrow\").style.transitionDuration = '300ms';\r\n\t\t\tthis.params.container.style.webkitTransitionDuration =\r\n\t\t    \tthis.params.container.style.transitionDuration = '0ms';\r\n\t\t\tself.params.container.style.webkitTransform =\r\n\t\t\tself.params.container.style.transform = 'translate3d(0,0,0)';\r\n\t\t\tself.params.container.classList.remove(\"aui-refresh-pull-up\");\r\n\t\t\tself.params.container.classList.add(\"aui-refresh-pull-down\");\r\n\t\t\treturn;\r\n\t\t},\r\n\t\tscrollY : function() {\r\n\t\t\treturn window.pageYOffset || docElem.scrollTop;\r\n\t\t},\r\n\t\tthrottle : function(fn, delay) {\r\n\t\t\tvar allowSample = true;\r\n\t\t\treturn function(e) {\r\n\t\t\t\tif (allowSample) {\r\n\t\t\t\t\tallowSample = false;\r\n\t\t\t\t\tsetTimeout(function() { allowSample = true; }, delay);\r\n\t\t\t\t\tfn(e);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t},\r\n\t\twinresize : function () {\r\n\t\t\tvar resize = function() {\r\n\t\t\t\twin = {width: window.innerWidth, height: window.innerHeight};\r\n\t\t\t};\r\n\t\t\tthrottle(resize(), 10);\r\n\t\t},\r\n\t\textend: function(a, b) {\r\n\t\t\tfor (var key in b) {\r\n\t\t\t  \tif (b.hasOwnProperty(key)) {\r\n\t\t\t  \t\ta[key] = b[key];\r\n\t\t\t  \t}\r\n\t\t  \t}\r\n\t\t  \treturn a;\r\n\t\t }\r\n\t}\r\n\twindow.auiPullToRefresh = auiPullToRefresh;\r\n\r\n})(window);"]}