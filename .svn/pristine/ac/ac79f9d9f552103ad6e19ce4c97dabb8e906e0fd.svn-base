!function(t,e){"function"==typeof define&&define.amd?define(["$"],e):"object"==typeof exports?module.exports=e():t.MobileSelectDate=e(window.Zepto||window.jQuery||$)}(this,function(t){var e=function(){var t=Math.random().toString().replace(".","");this.id="scroller_"+t,this.scroller,this.data,this.index=0,this.value=[0,0,0],this.oldvalue,this.oldtext,this.text=["","",""],this.level=3,this.mtop=30,this.separator=" "};return e.prototype={init:function(e){this.settings=t.extend({},e),this.separator="-";var i=new Date((new Date).getTime()+864e5);this.settings.value=this.settings.value||t(this.settings.trigger).val()||i.getFullYear()+"-"+("0"+(i.getMonth()+1)).slice(-2)+"-"+("0"+i.getDate()).slice(-2),this.settings.value=this.settings.value.replace(/-/g,","),this.settings.text=this.settings.value.split(","),void 0==this.settings["default"]?this["default"]=1:this["default"]=0,this.trigger=t(this.settings.trigger),this.trigger.attr("readonly","readonly"),this.value=this.settings.value&&this.settings.value.split(",")||[0,0,0],this.text=this.settings.text||this.trigger.val().split(" ")||["","",""],this.oldvalue=this.value.concat([]),this.oldtext=this.text.concat([]),this.min=new Date(this.settings.min||"1900-01-01"),this.settings.max?this.max=new Date(this.settings.max):this.max=new Date,this.getData(),this.bindEvent()},getData:function(){for(var t=[],e=(new Date).getFullYear(),i=(new Date).getMonth()+1,s=(new Date).getDate()+1,a=this.min.getFullYear(),n=this.max.getFullYear();a<=n;a++){var l,r={};r.id=r.name=a,r.child=[],l=a<=e?i:1;for(var h=l;h<=12;h++){var d,o={};o.id=o.name=("0"+h).slice(-2),o.child=[];var c=new Date(a,h,0).getDate();d=a<=e&&h<=l?s:1;for(var u=d;u<=c;u++){var g={};g.id=g.name=("0"+u).slice(-2),h==this.max.getMonth()+1&&a==this.max.getFullYear()&&u>this.max.getDate()||o.child.push(g)}h>this.max.getMonth()+1&&a==this.max.getFullYear()||r.child.push(o)}t.push(r)}this.data=t},bindEvent:function(){var e=this;this.trigger.click(function(i){var s,a;if("bottom"==e.settings.position){s={position:"bottom",width:"100%",className:"ui-dialog-bottom",animate:!1};var a=[{no:"取消"},{yes:"确定"}]}t.confirm('<div class="ui-scroller-mask"><div id="'+e.id+'" class="ui-scroller"><div></div><div ></div><div></div><p></p></div></div>',a,function(t,i){"yes"==t&&e.submit(),"no"==t&&e.cancel(),this.dispose()},t.extend({width:320,height:215},s)),e.scroller=t("#"+e.id),e.format();var n=0,l=0;return e.scroller.children().bind("touchstart",function(t){n=(t.changedTouches||t.originalEvent.changedTouches)[0].pageY}),e.scroller.children().bind("touchmove",function(e){l=(e.changedTouches||e.originalEvent.changedTouches)[0].pageY;var i=l-n,s=t(e.target).parent();if("DL"==s[0].nodeName){var a=parseInt(s.css("top")||0)+i;return s.css("top",a),n=l,!1}}),e.scroller.children().bind("touchend",function(i){l=(i.changedTouches||i.originalEvent.changedTouches)[0].pageY;var s=l-n,a=t(i.target).parent();if("DL"==a[0].nodeName){var r=t(a.parent()).index(),h=parseInt(a.css("top")||0)+s;h>e.mtop&&(h=e.mtop),h<-t(a).height()+60&&(h=-t(a).height()+60);var d=h/e.mtop,o=Math.round(d),c=Math.abs(o)+1;1==o&&(c=0),e.value[r]=t(a.children().get(c)).attr("ref"),0==e.value[r]?e.text[r]="":e.text[r]=t(a.children().get(c)).html();for(var u=e.level-1;u>r;u--)e.value[u]=0,e.text[u]="";return t(a.children().get(c)).hasClass("focus")||e.format(),t(a.children().get(c)).addClass("focus").siblings().removeClass("focus"),a.css("top",o*e.mtop),!1}}),!1})},format:function(){var t=this;t.scroller.children();this.f(this.data)},f:function(e){var i=this,s=e;s||(s=[]);var a,n='<dl><dd ref="0">——</dd>',l=0,r=i.mtop;if(0!==i.index&&"0"==i.value[i.index-1]&&0==this["default"])n='<dl><dd ref="0" class="focus">——</dd>',i.value[i.index]=0,i.text[i.index]="",l=0;else{if("0"==i.value[i.index]&&(n='<dl><dd ref="0" class="focus">——</dd>',l=0),s.length>0&&1==this["default"]){n="<dl>";var h=s[0].pid||0,d=s[0].id||0;l=s[0].id,a=s[0].child,i.value[this.index]||(i.value[this.index]=d,i.text[this.index]=s[0].name),n+='<dd pid="'+h+'" class="'+u+'" ref="'+d+'">'+s[0].name+"</dd>"}for(var o=i["default"],c=s.length;o<c;o++){var h=s[o].pid||0,d=s[o].id||0,u="";i.value[i.index]==d&&(u="focus",l=d,a=s[o].child,r=i.mtop*-(o-i["default"])),n+='<dd pid="'+h+'" class="'+u+'" ref="'+d+'">'+s[o].name+"</dd>"}}n+="</dl>";var g=t(n);g.css("top",r);var v=i.scroller.children();return t(v[i.index]).html(g),i.index++,i.index>i.level-1?void(i.index=0):void i.f(a)},submit:function(){this.oldvalue=this.value.concat([]),this.oldtext=this.text.concat([]),1==this.trigger[0].nodeType&&(this.trigger.val(this.text.join(this.separator)),this.trigger.attr("data-value",this.value.join(",")),"ps-time"==this.trigger.attr("id")&&OrderDetail.delay(this.text.join(this.separator))),this.trigger.next(":hidden").val(this.value.join(",")),this.settings.callback&&this.settings.callback(this.scroller)},cancel:function(){this.value=this.oldvalue.concat([]),this.text=this.oldtext.concat([])}},e});
//# sourceMappingURL=mobile-select-date.js.map
